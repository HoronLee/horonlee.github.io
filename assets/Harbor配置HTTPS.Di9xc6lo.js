import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BKY0BFev.js";import"./chunks/@vueuse/motion.C1YF0VrX.js";import{d as c,u as g,a as y}from"./chunks/vue-router.B0lpXBWQ.js";import{X as C,b3 as b,b_ as a,be as t,_ as s,a5 as i,bB as B,b5 as u}from"./framework.tSB2Odh-.js";import"./app.CfWrNu88.js";import"./chunks/dayjs.BmWuu2Zz.js";import"./chunks/vue-i18n.CP2UHYEb.js";import"./chunks/pinia.BF0-M7Fk.js";import"./chunks/nprogress.YXB5kar1.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.DoC94HOc.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CBF25nPr.js";import"./post.TKccRjPH.js";const m=c("/posts/Harbor配置HTTPS",async h=>JSON.parse('{"title":"Harbor配置HTTPS","description":"","frontmatter":{"title":"Harbor配置HTTPS","date":"2025-09-19 14:29:01","tags":["Harbor"],"categories":["运维"],"cover":"/attachment/Harbor配置HTTPS/820a57ef8505062f1dc5ecbad020da7f.png","dg-publish":true},"headers":[],"relativePath":"pages/posts/Harbor配置HTTPS.md","lastUpdated":1767692976000}'),{lazy:(h,e)=>h.name===e.name}),I={__name:"Harbor配置HTTPS",setup(h,{expose:e}){const{data:k}=m(),F=g(),p=y(),n=Object.assign(p.meta.frontmatter||{},k.value?.frontmatter||{});return F.currentRoute.value.data=k.value,u("valaxy:frontmatter",n),globalThis.$frontmatter=n,e({frontmatter:{title:"Harbor配置HTTPS",date:"2025-09-19 14:29:01",tags:["Harbor"],categories:["运维"],cover:"/attachment/Harbor配置HTTPS/820a57ef8505062f1dc5ecbad020da7f.png","dg-publish":!0}}),(l,r)=>{const o=d;return b(),C(o,{frontmatter:B(n)},{"main-content-md":a(()=>[...r[0]||(r[0]=[s("h2",{id:"需求",tabindex:"-1"},[i("需求 "),s("a",{class:"header-anchor",href:"#需求","aria-label":'Permalink to "需求"'},"​")],-1),s("p",null,"docker部署了一个harbor，需要配置docker和k3s集群https访问harbor，主机物理地址192.168.6.166",-1),s("p",null,"当前在家庭网络的OpenWrt中配置了harbor.local.com指向192.168.6.166",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  ssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," git:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"master"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"✗"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -i"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --tty"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dns-test"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --image=busybox"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --restart=Never"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --rm"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," sh")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"If"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," you"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," don't see a command prompt, try pressing enter.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/ # ping local.com")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PING local.com (192.168.6.166): 56 data bytes")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"64 bytes from 192.168.6.166: seq=0 ttl=64 time=0.082 ms")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"--- local.com ping statistics ---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"2 packets transmitted, 2 packets received, 0% packet loss")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"round-trip min/avg/max = 0.082/0.087/0.093 ms")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/ # ping harbor.local.com")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PING harbor.local.com (192.168.6.166): 56 data bytes")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"64 bytes from 192.168.6.166: seq=0 ttl=64 time=0.115 ms")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"--- harbor.local.com ping statistics ---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"2 packets transmitted, 2 packets received, 0% packet loss")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"round-trip min/avg/max = 0.098/0.106/0.115 ms")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"可以看到在k8s中也是生效的，如果无法配置路由器，也不要紧，可以按照下文改本机和k8s集群的配置！",-1),s("h2",{id:"签发证书",tabindex:"-1"},[i("签发证书 "),s("a",{class:"header-anchor",href:"#签发证书","aria-label":'Permalink to "签发证书"'},"​")],-1),s("p",null,[i("来自未来的TIPS：这里推荐一个工具"),s("a",{href:"https://github.com/Fishdrowned/ssl.git",target:"_blank",rel:"noreferrer"},"本地证书生成器"),i("，可以很方便得本地自签泛域名证书，适合docker和k8s内部自用 下文是来自于harbor文档的签署方法，我推荐用生成器")],-1),s("h3",{id:"生成-ca-私钥",tabindex:"-1"},[i("生成 CA 私钥 "),s("a",{class:"header-anchor",href:"#生成-ca-私钥","aria-label":'Permalink to "生成 CA 私钥"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," genrsa"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -out"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4096")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"生成自签-ca-证书",tabindex:"-1"},[i("生成自签 CA 证书 "),s("a",{class:"header-anchor",href:"#生成自签-ca-证书","aria-label":'Permalink to "生成自签 CA 证书"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," req"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -x509"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -new"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -nodes"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sha512"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -days"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 3650"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -subj"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/C=CN/ST=Zhejiang/L=Hangzhou/CN=MyPersonal Root CA"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -key"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -out"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca.crt")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"生成-harbor-域名私钥",tabindex:"-1"},[i("生成 Harbor 域名私钥 "),s("a",{class:"header-anchor",href:"#生成-harbor-域名私钥","aria-label":'Permalink to "生成 Harbor 域名私钥"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," genrsa"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -out"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4096")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"生成-harbor-域名的-csr",tabindex:"-1"},[i("生成 Harbor 域名的 CSR "),s("a",{class:"header-anchor",href:"#生成-harbor-域名的-csr","aria-label":'Permalink to "生成 Harbor 域名的 CSR"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," req"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sha512"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -new"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -subj"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/C=CN/ST=Zhejiang/L=Hangzhou/CN=harbor.local.com"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -key"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -out"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com.csr")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"生成-v3-ext-示例",tabindex:"-1"},[i("生成 v3.ext 示例 "),s("a",{class:"header-anchor",href:"#生成-v3-ext-示例","aria-label":'Permalink to "生成 v3.ext 示例"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cat"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," v3.ext"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<-"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"authorityKeyIdentifier=keyid,issuer")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"basicConstraints=CA:FALSE")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"extendedKeyUsage = serverAuth")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"subjectAltName = @alt_names")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[alt_names]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"DNS.1=harbor.local.com")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"IP.1=192.168.6.166")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"创建-v3-ext文件",tabindex:"-1"},[i("创建 v3.ext文件 "),s("a",{class:"header-anchor",href:"#创建-v3-ext文件","aria-label":'Permalink to "创建 v3.ext文件"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," x509"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -req"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sha512"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -days"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 3650"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -extfile"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," v3.ext"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -CA"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca.crt"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -CAkey"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca.key"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -CAcreateserial"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -in"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com.csr"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  -out"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com.crt")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"添加域名解析",tabindex:"-1"},[i("添加域名解析 "),s("a",{class:"header-anchor",href:"#添加域名解析","aria-label":'Permalink to "添加域名解析"'},"​")],-1),s("h3",{id:"本机解析",tabindex:"-1"},[i("本机解析 "),s("a",{class:"header-anchor",href:"#本机解析","aria-label":'Permalink to "本机解析"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  ~"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," cat"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/hosts")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Static table lookup for hostnames.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# See hosts(5) for details.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"127.0.0.1"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"        localhost")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},":"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},":1"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"              localhost")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"192.168.6.166"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    harbor.local.com")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"k8s集群解析",tabindex:"-1"},[i("K8S集群解析 "),s("a",{class:"header-anchor",href:"#k8s集群解析","aria-label":'Permalink to "K8S集群解析"'},"​")],-1),s("p",null,"直接编辑coredns的configmap，在hosts字段中添加所需解析",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kube-system"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," edit"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," configmap"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," coredns")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hosts"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  192.168.6.166"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  fallthrough")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"docker使用证书",tabindex:"-1"},[i("Docker使用证书 "),s("a",{class:"header-anchor",href:"#docker使用证书","aria-label":'Permalink to "Docker使用证书"'},"​")],-1),s("p",null,[i("切记，在配置文件中不能再配置"),s("code",null,'"insecure-registries": ["192.168.6.166:8088"]'),i("之类的字段了！")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  docker"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," cat"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," daemon.json")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'        "registry-mirrors"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},":"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'                "https://docker.1ms.run"'),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'                "https://docker.1panelproxy.com"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"创建文件夹，放入三样证书",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  harbor.local.com:8082"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pwd")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"/etc/docker/certs.d/harbor.local.com:8082")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  harbor.local.com:8082"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ls")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ca.crt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  harbor.local.com.cert"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  harbor.local.com.key")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"k3s使用证书",tabindex:"-1"},[i("k3s使用证书 "),s("a",{class:"header-anchor",href:"#k3s使用证书","aria-label":'Permalink to "k3s使用证书"'},"​")],-1),s("p",null,"和docker同理，指定三样证书文件即可，但是需要额外编写配置字段，如下",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  ~"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," cat"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/rancher/k3s/registries.yaml")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mirrors:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  harbor.local.com:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    endpoint:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      -"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "https://harbor.local.com:8082"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"configs:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'  "harbor.local.com:8082"'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    auth:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      username:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," admin")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      password:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," horon63163798")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    tls:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      cert_file:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/harbor/certs.d/harbor.local.com.cert")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      key_file:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/harbor/certs.d/harbor.local.com.key")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      ca_file:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/harbor/certs.d/ca.crt")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"containerd使用证书",tabindex:"-1"},[i("Containerd使用证书 "),s("a",{class:"header-anchor",href:"#containerd使用证书","aria-label":'Permalink to "Containerd使用证书"'},"​")],-1),s("p",null,"先创建配置文件，注意目录也需要添加端口号",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"root@R430:/opt/harbor#"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mkdir"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/containerd/certs.d/harbor.local.com:8082")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"root@R430:/opt/harbor#"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," cat"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/containerd/certs.d/harbor.local.com:8082/hosts.toml"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," EOF")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'server = "https://harbor.local.com:8082"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'[host."https://harbor.local.com:8082"]')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  capabilities = ["pull", "resolve", "push"]')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  skip_verify = true")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"重启containerd",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"root@R430:/opt/harbor#"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," containerd")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("用nerdctl登录测试，其中参数"),s("code",null,"--insecure-registry"),i("可以不加")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"root@R430:/opt/harbor#"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nerdctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," login"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," admin"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --insecure-registry"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," harbor.local.com:8082")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Enter"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Password:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"WARN[0003]"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," skipping"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," verifying"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," HTTPS"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," certs"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," for"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "harbor.local.com:8082"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Login"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Succeeded")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"成功！",-1),s("h2",{id:"k8s授权访问",tabindex:"-1"},[i("k8s授权访问 "),s("a",{class:"header-anchor",href:"#k8s授权访问","aria-label":'Permalink to "k8s授权访问"'},"​")],-1),s("p",null,"使用如下命令创建一个Secret对象",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," create"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," secret"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker-registry"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," registry-secret"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --namespace=default"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --docker-server=[不带有协议的harbor域名]"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --docker-username=admin"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --docker-password=[你的密码]")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"测试",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"➜"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  ssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," git:"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"master"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"✗"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -i"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --tty"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dns-test"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --image=harbor.local.com:8082/library/busybox"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --restart=Never"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --rm"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," sh")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"If"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," you"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," don't see a command prompt, try pressing enter.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/ #")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"➜  /opt kubectl describe po dns-test")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"...省略")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  Type    Reason     Age   From               Message")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  ----    ------     ----  ----               -------")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  Normal  Scheduled  14s   default-scheduler  Successfully assigned default/dns-test to r430")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  Normal  Pulling    13s   kubelet            Pulling image "harbor.local.com:8082/library/busybox"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  Normal  Pulled     13s   kubelet            Successfully pulled image "harbor.local.com:8082/library/busybox" in 243ms (243ms including waiting). Image size: 2156518 bytes.')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  Normal  Created    13s   kubelet            Created container: dns-test")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  Normal  Started    13s   kubelet            Started container dns-test")])])]),s("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":a(()=>[t(l.$slots,"main-header")]),"main-header-after":a(()=>[t(l.$slots,"main-header-after")]),"main-nav":a(()=>[t(l.$slots,"main-nav")]),"main-content-before":a(()=>[t(l.$slots,"main-content-before")]),"main-content":a(()=>[t(l.$slots,"main-content")]),"main-content-after":a(()=>[t(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[t(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[t(l.$slots,"main-nav-after")]),comment:a(()=>[t(l.$slots,"comment")]),footer:a(()=>[t(l.$slots,"footer")]),aside:a(()=>[t(l.$slots,"aside")]),"aside-custom":a(()=>[t(l.$slots,"aside-custom")]),default:a(()=>[t(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{I as default,m as usePageData};
