import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CVz-OEk3.js";import"./chunks/@vueuse/motion.Bjv2JULu.js";import{e as u,u as g,a as F}from"./chunks/vue-router.CkK6wkE3.js";import{aa as b,al as e,ad as l,ae as s,ai as i,F as y,ab as C,Z as m}from"./framework.DiIp3j3P.js";import"./app.DYfWnlAw.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.Cqw7qwJJ.js";import"./chunks/pinia.DAg2g0nX.js";import"./chunks/nprogress.QNtX8Req.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.YMmXRdII.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.NFwy7W3t.js";import"./post.DSQTc9o3.js";const B=u("/posts/ubuntu22.04-k8s-deploy",async t=>JSON.parse('{"title":"ubuntu22.04-k8s-deploy","description":"","frontmatter":{"layout":"post","title":"ubuntu22.04-k8s-deploy","date":"2024-05-25 10:24:56","tags":["Linux","Kubernetes","云计算","Ubuntu"],"categories":["云计算","Kubernetes"],"cover":"https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg","password":null,"hide":null},"headers":[],"relativePath":"pages/posts/ubuntu22.04-k8s-deploy.md","lastUpdated":1758206429000}'),{lazy:(t,n)=>t.name===n.name}),O={__name:"ubuntu22.04-k8s-deploy",setup(t,{expose:n}){const{data:k}=B(),o=F(),c=g(),h=Object.assign(c.meta.frontmatter||{},k.value?.frontmatter||{});return o.currentRoute.value.data=k.value,m("valaxy:frontmatter",h),globalThis.$frontmatter=h,n({frontmatter:{layout:"post",title:"ubuntu22.04-k8s-deploy",date:"2024-05-25 10:24:56",tags:["Linux","Kubernetes","云计算","Ubuntu"],categories:["云计算","Kubernetes"],cover:"https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg",password:null,hide:null}}),(a,r)=>{const d=p;return C(),b(d,{frontmatter:y(h)},{"main-content-md":e(()=>[...r[0]||(r[0]=[s("h1",{id:"ubuntu22-04部署k8s",tabindex:"-1"},[i("Ubuntu22.04部署K8S "),s("a",{class:"header-anchor",href:"#ubuntu22-04部署k8s","aria-label":'Permalink to "Ubuntu22.04部署K8S"'},"​")],-1),s("ul",null,[s("li",null,"Kubernetes 版本：1.29.5"),s("li",null,"Linux 版本：Linux master 5.15.0-107-generic #117-Ubuntu SMP Fri Apr 26 12:26:49 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux"),s("li",null,"实测可用，几乎是最新的配置方法")],-1),s("blockquote",null,[s("p",null,"本文中出现的172.30.27.143地址为本人学校内网环境地址，不公开在外网，请读者忽略，软件包的下载请前往各官网")],-1),s("h1",{id:"准备工作",tabindex:"-1"},[i("准备工作 "),s("a",{class:"header-anchor",href:"#准备工作","aria-label":'Permalink to "准备工作"'},"​")],-1),s("h2",{id:"配置-host",tabindex:"-1"},[i("配置 host "),s("a",{class:"header-anchor",href:"#配置-host","aria-label":'Permalink to "配置 host"'},"​")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"172.30.26.226 master")]),i(`
`),s("span",{class:"line"},[s("span",null,"172.30.26.227 worker1")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"关闭-swap-分区",tabindex:"-1"},[i("关闭 swap 分区 "),s("a",{class:"header-anchor",href:"#关闭-swap-分区","aria-label":'Permalink to "关闭 swap 分区"'},"​")],-1),s("p",null,[i("打开终端，并以管理员权限执行"),s("code",null,"sudo swapoff -a"),i("命令来禁用交换分区。")],-1),s("p",null,[i("上述方法只能暂时禁用，若需要永久禁止交换分区，需要编辑 "),s("code",null,"/etc/fstab"),i(", 在文件中找到与交换分区相关的行，通常以类似于 "),s("code",null,"/swapfile"),i(" 或 "),s("code",null,"/dev/sdXY"),i("（其中 XY 是分区标识符）的形式出现。将这些行注释掉（在行的开头添加 # 符号），或者删除这些行，然后重启系统，示例:")],-1),s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"# /swap.img     none    swap    sw      0       0")]),i(`
`),s("span",{class:"line"},[s("span",null,"# /dev/sdXY     none    swap    sw      0       0")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"安装容器运行时",tabindex:"-1"},[i("安装容器运行时 "),s("a",{class:"header-anchor",href:"#安装容器运行时","aria-label":'Permalink to "安装容器运行时"'},"​")],-1),s("p",null,[i("你需要在集群内每个节点上安装一个 "),s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes",target:"_blank",rel:"noreferrer"},"容器运行时"),i(" 以使 Pod 可以运行在上面。本文概述了所涉及的内容并描述了与节点设置相关的任务。")],-1),s("p",null,[i("Kubernetes 1.30 要求你使用符合"),s("a",{href:"https://kubernetes.io/zh-cn/docs/concepts/overview/components/#container-runtime",target:"_blank",rel:"noreferrer"},"容器运行时接口"),i("（CRI）的运行时。")],-1),s("p",null,[i("有关详细信息，请参阅 "),s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cri-versions",target:"_blank",rel:"noreferrer"},"CRI 版本支持"),i("。 本页简要介绍在 Kubernetes 中几个常见的容器运行时的用法。")],-1),s("ul",null,[s("li",null,[s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#containerd",target:"_blank",rel:"noreferrer"},"containerd")]),s("li",null,[s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cri-o",target:"_blank",rel:"noreferrer"},"CRI-O")]),s("li",null,[s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#docker",target:"_blank",rel:"noreferrer"},"Docker Engine")]),s("li",null,[s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#mcr",target:"_blank",rel:"noreferrer"},"Mirantis Container Runtime")])],-1),s("h2",{id:"转发-ipv4-并让-iptables-看到桥接流量",tabindex:"-1"},[i("转发 IPv4 并让 iptables 看到桥接流量 "),s("a",{class:"header-anchor",href:"#转发-ipv4-并让-iptables-看到桥接流量","aria-label":'Permalink to "转发 IPv4 并让 iptables 看到桥接流量"'},"​")],-1),s("p",null,"执行下述命令：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cat"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," tee"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/modules-load.d/k8s.conf")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"overlay")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"br_netfilter")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," modprobe"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," overlay")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," modprobe"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," br_netfilter")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 设置所需的 sysctl 参数，参数在重新启动后保持不变")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cat"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," tee"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/sysctl.d/k8s.conf")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"net.bridge.bridge-nf-call-iptables  = 1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"net.bridge.bridge-nf-call-ip6tables = 1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"net.ipv4.ip_forward                 = 1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"EOF")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 应用 sysctl 参数而不重新启动")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," sysctl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --system")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h1",{id:"安装continerd",tabindex:"-1"},[i("安装continerd "),s("a",{class:"header-anchor",href:"#安装continerd","aria-label":'Permalink to "安装continerd"'},"​")],-1),s("p",null,[i("我们使用"),s("code",null,"apt-get"),i("来安装 containerd，这里需要参考Dockers的官方安装文档：")],-1),s("p",null,[s("a",{href:"https://docs.docker.com/engine/install/ubuntu/",target:"_blank",rel:"noreferrer"},"在 Ubuntu 上安装 Docker 引擎 |Docker 文档")],-1),s("h3",{id:"设置-docker-存储库",tabindex:"-1"},[i("设置 Docker 存储库 "),s("a",{class:"header-anchor",href:"#设置-docker-存储库","aria-label":'Permalink to "设置 Docker 存储库"'},"​")],-1),s("p",null,"添加 Docker 官方 GPG 密钥",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca-certificates"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," curl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -m"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0755"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -fsSL"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://download.docker.com/linux/ubuntu/gpg"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings/docker.asc")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," chmod"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," a+r"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings/docker.asc")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"添加-apt-软件源",tabindex:"-1"},[i("添加 apt 软件源 "),s("a",{class:"header-anchor",href:"#添加-apt-软件源","aria-label":'Permalink to "添加 apt 软件源"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  "deb [arch=$('),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dpkg"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --print-architecture"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},") signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  $("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"."),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/os-release && "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$VERSION_CODENAME"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'") stable"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," tee"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/sources.list.d/docker.list"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /dev/null")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"安装-docker-及其插件",tabindex:"-1"},[i("安装 Docker 及其插件 "),s("a",{class:"header-anchor",href:"#安装-docker-及其插件","aria-label":'Permalink to "安装 Docker 及其插件"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker-ce"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker-ce-cli"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," containerd.io"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker-buildx-plugin"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker-compose-plugin")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h3",{id:"启用-docker",tabindex:"-1"},[i("启用 Docker "),s("a",{class:"header-anchor",href:"#启用-docker","aria-label":'Permalink to "启用 Docker"'},"​")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enable"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --now")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"安装-cni-网络插件",tabindex:"-1"},[i("安装 CNI 网络插件 "),s("a",{class:"header-anchor",href:"#安装-cni-网络插件","aria-label":'Permalink to "安装 CNI 网络插件"'},"​")],-1),s("p",null,[i("注意，"),s("a",{href:"https://link.zhihu.com/?target=http%3A//containerd.io",target:"_blank",rel:"noreferrer"},"http://containerd.io"),i("包括了"),s("code",null,"runc"),i(", 但是不包括CNI插件，我们需要"),s("a",{href:"https://link.zhihu.com/?target=https%3A//github.com/containerd/containerd/blob/main/docs/getting-started.md%23step-3-installing-cni-plugins",target:"_blank",rel:"noreferrer"},"手动安装CNI插件"),i("：")],-1),s("p",null,[i("访问："),s("a",{href:"https://link.zhihu.com/?target=https%3A//github.com/containernetworking/plugins/releases",target:"_blank",rel:"noreferrer"},"Releases · containernetworking/plugins (github.com)"),i("获取最新版本的插件，然后将其安装到"),s("code",null,"/opt/cni/bin"),i("中")],-1),s("ul",null,[s("li",null,[i("下载插件"),s("code",null,"curl -O https://github.com/containernetworking/plugins/releases/download/v1.5.1/cni-plugins-linux-amd64-v1.5.1.tgz")]),s("li",null,[i("新建软件包目录"),s("code",null,"mkdir -p /opt/cni/bin")]),s("li",null,[i("解压 CNI 软件到指定目录"),s("code",null,"tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.5.1.tgz")])],-1),s("h3",{id:"生成默认配置文件",tabindex:"-1"},[i("生成默认配置文件 "),s("a",{class:"header-anchor",href:"#生成默认配置文件","aria-label":'Permalink to "生成默认配置文件"'},"​")],-1),s("p",null,"此时还有一个重要的步骤，那就是生成containerd的配置文件。可以通过以下命令生成默认的配置文件：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"containerd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," config"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," default"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/containerd/config.toml")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("该命令同样来自同一个文档："),s("a",{href:"https://link.zhihu.com/?target=https%3A//github.com/containerd/containerd/blob/main/docs/getting-started.md%23customizing-containerd",target:"_blank",rel:"noreferrer"},"Customizing containerd")],-1),s("h3",{id:"配置-containerd-的systemd-cgroup-驱动",tabindex:"-1"},[i("配置 containerd 的systemd cgroup 驱动 "),s("a",{class:"header-anchor",href:"#配置-containerd-的systemd-cgroup-驱动","aria-label":'Permalink to "配置 containerd 的systemd cgroup 驱动"'},"​")],-1),s("p",null,[i("在 "),s("code",null,"/etc/containerd/config.toml"),i(" 中设置：")],-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,'[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]')]),i(`
`),s("span",{class:"line"},[s("span",null,"  ...")]),i(`
`),s("span",{class:"line"},[s("span",null,'  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]')]),i(`
`),s("span",{class:"line"},[s("span",null,"    SystemdCgroup = true")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("为什么要配置contaierd的cgroup 驱动为systemd ，这来自文档："),s("a",{href:"https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cgroup-drivers",target:"_blank",rel:"noreferrer"},"Container Runtimes | Kubernetes")],-1),s("h3",{id:"重载沙箱-pause-镜像",tabindex:"-1"},[i("重载沙箱（pause）镜像 "),s("a",{class:"header-anchor",href:"#重载沙箱-pause-镜像","aria-label":'Permalink to "重载沙箱（pause）镜像"'},"​")],-1),s("p",null,"我们在国内无法访问 k8s 官方的镜像仓库，所以需要设置 pause 镜像的国内源",-1),s("p",null,[i("在 "),s("code",null,"/etc/containerd/config.toml"),i(" 中设置：")],-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,'[plugins."io.containerd.grpc.v1.cri"]')]),i(`
`),s("span",{class:"line"},[s("span",null,'  sandbox_image = "registry.aliyuncs.com/google_containers/pause:3.9"')])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("一旦你更新了这个配置文件，就同样需要重启 "),s("code",null,"containerd"),i("："),s("code",null,"systemctl restart containerd"),i("。")],-1),s("h1",{id:"安装-kubeadm、kubelet-和-kubectl",tabindex:"-1"},[i("安装 kubeadm、kubelet 和 kubectl "),s("a",{class:"header-anchor",href:"#安装-kubeadm、kubelet-和-kubectl","aria-label":'Permalink to "安装 kubeadm、kubelet 和 kubectl"'},"​")],-1),s("p",null,"这里推荐使用阿里云的镜像软件源：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-transport-https")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -fsSL"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.29/deb/Release.key"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    gpg"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --dearmor"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings/kubernetes-apt-keyring.gpg")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"echo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.29/deb/ /"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    tee"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/sources.list.d/kubernetes.list")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubelet"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enable"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubelet"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --now")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"如果有特殊的网络环境，可以使用最新 kubernetes 官方软件源：",-1),s("ol",null,[s("li",null,[i("更新 "),s("code",null,"apt"),i(" 包索引，并安装使用 Kubernetes "),s("code",null,"apt"),i(" 仓库所需要的包：")])],-1),s("div",{class:"language-shell"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# apt-transport-https 可以是一个虚拟包；如果是这样，你可以跳过这个包")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," apt-transport-https"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ca-certificates"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," curl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gnupg")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("ol",{start:"2"},[s("li",null,"下载 Kubernetes 软件包仓库的公共签名密钥。 同一个签名密钥适用于所有仓库，因此你可以忽略 URL 中的版本信息：")],-1),s("div",{class:"language-shell"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 如果 `/etc/apt/keyrings` 目录不存在，则应在 curl 命令之前创建它，请阅读下面的注释。")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# sudo mkdir -p -m 755 /etc/apt/keyrings")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -fsSL"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gpg"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --dearmor"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings/kubernetes-apt-keyring.gpg")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," chmod"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 644"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/apt/keyrings/kubernetes-apt-keyring.gpg"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," # allow unprivileged APT programs to read ")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apt-get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -y"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubelet"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enable"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubelet"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --now")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"配置kubelet的-cgroup-驱动",tabindex:"-1"},[i("配置kubelet的 cgroup 驱动 "),s("a",{class:"header-anchor",href:"#配置kubelet的-cgroup-驱动","aria-label":'Permalink to "配置kubelet的 cgroup 驱动"'},"​")],-1),s("p",null,[s("a",{href:"https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/#configuring-the-kubelet-cgroup-driver",target:"_blank",rel:"noreferrer"},"Configuring a cgroup driver | Kubernetes")],-1),s("p",null,"很幸运的是，在v1.22版本以后，默认的驱动就是systemd了，因此如果是在安装最新版本的K8s, 那么就不需要再配置kubelet的cgroup驱动了。",-1),s("h1",{id:"使用-kubeadm-创建集群",tabindex:"-1"},[i("使用 kubeadm 创建集群 "),s("a",{class:"header-anchor",href:"#使用-kubeadm-创建集群","aria-label":'Permalink to "使用 kubeadm 创建集群"'},"​")],-1),s("h2",{id:"初始化控制平面",tabindex:"-1"},[i("初始化控制平面 "),s("a",{class:"header-anchor",href:"#初始化控制平面","aria-label":'Permalink to "初始化控制平面"'},"​")],-1),s("p",null,"你只需要下述简单的执行下述命令即可：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," init"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --pod-network-cidr=192.168.0.0/16")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"之后就可以等待初始化完成，其他的需要注意的参数可以阅读官方文档。",-1),s("p",null,[i("注意这里的"),s("code",null,"--pod-network-cidr=192.168.0.0/16"),i("是为了配合第五章的网络插件，Calico文档中推荐我们使用此配置。")],-1),s("p",null,"第一次初始化拉取镜像可能需要一些时间，镜像拉取成功之后，初始化是非常快的，几秒内即可完成，如果失败，那必然是遇到了问题。具体遇到了什么问题就需要查看kubectl服务的日志：",-1),s("h2",{id:"配置kubectl",tabindex:"-1"},[i("配置kubectl "),s("a",{class:"header-anchor",href:"#配置kubectl","aria-label":'Permalink to "配置kubectl"'},"​")],-1),s("p",null,"当初始化完成时，可以看到以下类似的输出：",-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"完成之后你应该看到：")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"Your Kubernetes control-plane has initialized successfully!")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"To start using your cluster, you need to run the following as a regular user:")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"  mkdir -p $HOME/.kube")]),i(`
`),s("span",{class:"line"},[s("span",null,"  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),i(`
`),s("span",{class:"line"},[s("span",null,"  sudo chown $(id -u):$(id -g) $HOME/.kube/config")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"You should now deploy a Pod network to the cluster.")]),i(`
`),s("span",{class:"line"},[s("span",null,'Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:')]),i(`
`),s("span",{class:"line"},[s("span",null,"  /docs/concepts/cluster-administration/addons/")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"You can now join any number of machines by running the following on each node")]),i(`
`),s("span",{class:"line"},[s("span",null,"as root:")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"  kubeadm join <control-plane-host>:<control-plane-port> --token <token> --discovery-token-ca-cert-hash sha256:<hash>")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("要使非 root 用户可以运行 kubectl，请运行以下命令， 它们也是 "),s("code",null,"kubeadm init"),i(" 输出的一部分：")],-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"mkdir -p $HOME/.kube")]),i(`
`),s("span",{class:"line"},[s("span",null,"sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),i(`
`),s("span",{class:"line"},[s("span",null,"sudo chown $(id -u):$(id -g) $HOME/.kube/config")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("或者，如果你是 "),s("code",null,"root"),i(" 用户，则可以运行：")],-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"export KUBECONFIG=/etc/kubernetes/admin.conf")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("记录"),s("code",null,"kubeadm init"),i("输出的"),s("code",null,"kubeadm join"),i("命令。 你需要此命令"),s("a",{href:"https://link.zhihu.com/?target=https%3A//kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/%23join-nodes",target:"_blank",rel:"noreferrer"},"将节点加入集群"),i("。")],-1),s("h1",{id:"安装-pod-网络附加组件",tabindex:"-1"},[i("安装 Pod 网络附加组件 "),s("a",{class:"header-anchor",href:"#安装-pod-网络附加组件","aria-label":'Permalink to "安装 Pod 网络附加组件"'},"​")],-1),s("blockquote",null,[s("p",null,[s("strong",null,[i("你必须部署一个基于 Pod 网络插件的[容器网络接口]("),s("a",{href:"https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/",target:"_blank",rel:"noreferrer"},"网络插件 | Kubernetes"),i(")(CNI)，以便你的 Pod 可以相互通信。 在安装网络之前，集群 DNS (CoreDNS) 将不会启动。并且在安装网络插件之前，node都是NotReady的状态(出自[此处]("),s("a",{href:"https://docs.tigera.io/calico/latest/getting-started/kubernetes/hardway/standing-up-kubernetes#install-kubernetes",target:"_blank",rel:"noreferrer"},"Stand up Kubernetes | Calico Documentation (tigera.io)"),i("))。")])])],-1),s("p",null,[i("有许多网络插件可以使用（"),s("a",{href:"https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/#networking-and-network-policy",target:"_blank",rel:"noreferrer"},"安装扩展（Addon） | Kubernetes"),i("），我们在这里，将选择安装"),s("a",{href:"https://link.zhihu.com/?target=https%3A//www.tigera.io/project-calico/",target:"_blank",rel:"noreferrer"},"Calico"),i("插件，其参考文档："),s("a",{href:"https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart",target:"_blank",rel:"noreferrer"},"Quickstart for Calico on Kubernetes | Calico Documentation (tigera.io)"),i("（使用最新的 3.28 版本）")],-1),s("ol",null,[s("li",null,[s("p",null,"安装 Tigera Calico 运算符和自定义资源定义。"),s("blockquote",null,[s("p",null,[i("注意：由于 CRD 捆绑包的大小较大，国内访问 GitHub 也非常慢，且可能会超出请求限制，所以可以将 两个 yaml 文件下载下来，再对其 "),s("code",null,"create"),i("！")])]),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," create"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -f"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://raw.githubusercontent.com/projectcalico/calico/v3.28.0/manifests/tigera-operator.yaml")])])]),s("button",{class:"code-block-unfold-btn"})])]),s("li",null,[s("p",null,[i("通过创建必要的自定义资源来安装 Calico。有关此清单中可用的配置选项的详细信息，请参阅"),s("a",{href:"https://docs.tigera.io/calico/latest/reference/installation/api",target:"_blank",rel:"noreferrer"},"安装参考"),i("。")]),s("blockquote",null,[s("p",null,"注意：在创建此清单之前，请阅读其内容并确保其设置适合您的环境。例如 您可能需要更改默认 IP 池 CIDR 以匹配您的容器网络 CIDR。")]),s("p",null,[i("编辑"),s("code",null,"custom-resources.yaml"),i("文件，更改里面的"),s("code",null,"cidr:"),i("后面的 IP 地址为最开始"),s("code",null,"kubeadm init"),i("的时候"),s("code",null,"--pod-network-cidr="),i("后面的 IP 地址（如 10.244.0.0/16）")]),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," create"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -f"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://raw.githubusercontent.com/projectcalico/calico/v3.28.0/manifests/custom-resources.yaml")])])]),s("button",{class:"code-block-unfold-btn"})])]),s("li",null,[s("p",null,"使用以下命令确认所有 Pod 都在运行。（大约需要等待五分钟甚至更长时间来完成运行）"),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"watch"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," get"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pods"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," calico-system")])])]),s("button",{class:"code-block-unfold-btn"})]),s("p",null,[i("等到每个 Pod 都具有"),s("code",null,"STATUS"),i(),s("code",null,"Running")]),s("blockquote",null,[s("p",null,[i("注意：Tigera 运算符在命名空间中安装资源。其他安装方法可能使用 命名空间。"),s("code",null,"calico-system"),i(),s("code",null,"kube-system")])])])],-1),s("p",null,[i("Calico 还取消了master 节点的"),s("code",null,"control-plane"),i("污点，但是我们"),s("strong",null,"不要"),i("这么做，因为在生产环境中master 节点最好只起到控制集群的作用"),s("code",null,"kubectl taint nodes --all node-role.kubernetes.io/control-plane-")],-1),s("p",null,[i("现在通过"),s("code",null,"kubectl get nodes -o wide"),i("可以看到所有节点都在 Ready 的 STATUS ！")],-1),s("h1",{id:"将控制平面节点加入pod调度节点",tabindex:"-1"},[i("将控制平面节点加入Pod调度节点 "),s("a",{class:"header-anchor",href:"#将控制平面节点加入pod调度节点","aria-label":'Permalink to "将控制平面节点加入Pod调度节点"'},"​")],-1),s("p",null,"节点是你的工作负载（容器和 Pod 等）运行的地方。要将新节点添加到集群，请对每台计算机执行以下操作：",-1),s("ul",null,[s("li",null,[s("p",null,"SSH 到机器")]),s("li",null,[s("p",null,[i("成为 root （例如 "),s("code",null,"sudo su -"),i("）")])]),s("li",null,[s("p",null,[i("必要时"),s("a",{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime",target:"_blank",rel:"noreferrer"},"安装一个运行时")])]),s("li",null,[s("p",null,[i("运行 "),s("code",null,"kubeadm init"),i(" 输出的命令，例如：")]),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," join"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --token"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"toke"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"n"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"control-plane-hos"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"t"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},":"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"control-plane-por"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"t"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --discovery-token-ca-cert-hash"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," sha256:"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"has"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"h"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),s("button",{class:"code-block-unfold-btn"})])]),s("li",null,[s("p",null,[i("实际上这个命令就是"),s("code",null,"kubeadm join 172.30.26.226:6443 --token esm234.gwuedugnjtoluzu2 --discovery-token-ca-cert-hash sha256:7e4f72aae1fee69937739f4844adc629d3a36fba374112cd7af0a8ceb296c545")])])],-1),s("p",null,"如果你没有令牌，可以通过在控制平面节点上运行以下命令来获取令牌：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," token"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," list")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"输出类似于以下内容：",-1),s("div",{class:"language-console"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"console"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"TOKEN                    TTL  EXPIRES              USAGES           DESCRIPTION            EXTRA GROUPS")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8ewj1p.9r9hcjoqgajrj4gi  23h  2018-06-12T02:51:28Z authentication,  The default bootstrap  system:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"                                                   signing          token generated by     bootstrappers:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"                                                                    'kubeadm init'.        kubeadm:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"                                                                                           default-node-token")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"默认情况下，令牌会在 24 小时后过期。如果要在当前令牌过期后将节点加入集群， 则可以通过在控制平面节点上运行以下命令来创建新令牌：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," token"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," create")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"输出类似于以下内容：",-1),s("div",{class:"language-console"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"console"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5didvk.d09sbcov8ph2amjw")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("如果你没有 "),s("code",null,"--discovery-token-ca-cert-hash"),i(" 的值，则可以通过在控制平面节点上执行以下命令链来获取它：")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," x509"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -pubkey"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -in"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/kubernetes/pki/ca.crt"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," rsa"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -pubin"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -outform"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," der"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," 2>"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/dev/null"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"   openssl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," dgst"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -sha256"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -hex"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sed"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 's/^.*"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," //'")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"输出类似于以下内容：",-1),s("div",{class:"language-console"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"console"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8cb2de97839780a412b93877f8507ad6c94f73add17d5d7058e91741c9d5ec78")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"当你执行完加入节点的命令后，应该会出现类似如下的回显：",-1),s("div",{class:"language-console"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"console"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"[preflight] Running pre-flight checks")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"... (log output of join workflow) ...")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Node join complete:")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"* Certificate signing request sent to control-plane and response")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  received.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"* Kubelet informed of new secure connection details.")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Run 'kubectl get nodes' on control-plane to see this machine join.")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("几秒钟后，当你在控制平面节点上执行 "),s("code",null,"kubectl get nodes"),i("，你会注意到该节点出现在输出中，一开始它的状态可能是 NotReady，但是等待一段时间后就会在 Ready 状态了。")],-1),s("h1",{id:"清理",tabindex:"-1"},[i("清理 "),s("a",{class:"header-anchor",href:"#清理","aria-label":'Permalink to "清理"'},"​")],-1),s("p",null,[i("如果你在集群中使用了一次性服务器进行测试，则可以关闭这些服务器，而无需进一步清理。 你可以使用 "),s("code",null,"kubectl config delete-cluster"),i(" 删除对集群的本地引用。")],-1),s("p",null,[i("但是，如果要更干净地取消配置集群， 则应首先"),s("a",{href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#drain",target:"_blank",rel:"noreferrer"},"清空节点"),i("并确保该节点为空， 然后取消配置该节点。")],-1),s("h2",{id:"移除节点",tabindex:"-1"},[i("移除节点 "),s("a",{class:"header-anchor",href:"#移除节点","aria-label":'Permalink to "移除节点"'},"​")],-1),s("p",null,"使用适当的凭据与控制平面节点通信，运行：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," drain"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"节点名"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"称"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --delete-emptydir-data"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --force"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --ignore-daemonsets")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("在移除节点之前，请重置 "),s("code",null,"kubeadm"),i(" 安装的状态：")],-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubeadm"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," reset")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"重置过程不会重置或清除 iptables 规则或 IPVS 表。如果你希望重置 iptables，则必须手动进行：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"iptables"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"iptables"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -t"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"iptables"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -t"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mangle"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -F"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"iptables"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -X")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"如果要重置 IPVS 表，则必须运行以下命令：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ipvsadm"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -C")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"现在移除节点：",-1),s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"kubectl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," delete"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," node"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"节点名"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"称"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("如果你想重新开始，只需运行 "),s("code",null,"kubeadm init"),i(" 或 "),s("code",null,"kubeadm join"),i(" 并加上适当的参数。")],-1),s("h1",{id:"the-end👋",tabindex:"-1"},[i("The End👋 "),s("a",{class:"header-anchor",href:"#the-end👋","aria-label":'Permalink to "The End👋"'},"​")],-1),s("p",null,"现在，你已经学会了在 Ubuntu22.04 环境下搭建 kubernetes 集群，是不是觉得比在 CentOS 中要简单很多？",-1),s("p",null,[i("本文绝大多数内容都是从官方文档照搬的，这说明了官方文档就是最好的指导书，或许你之前看过很多的博文，但都或多或少有失败经历，那是因为文章具有时效性，之前可行的办法在后续版本可能就不行了，比如正在之前"),s("code",null,"kubeadm init"),i("步骤需要添加很多的参数（或者通过配置文件进行初始化），现在却根本不需要！")],-1),s("p",null,[i("如果意犹未尽，不妨看看我的新文章"),s("a",{href:"https://blog.horonlee.com/posts/K8sJenkinsSlaveCICD",target:"_blank",rel:"noreferrer"},"Jenkins的标准用法“Jenkins-Slave” - 皓然小站 (horonlee.com)")],-1),s("p",null,"See you soon～",-1)])]),"main-header":e(()=>[l(a.$slots,"main-header")]),"main-header-after":e(()=>[l(a.$slots,"main-header-after")]),"main-nav":e(()=>[l(a.$slots,"main-nav")]),"main-content-before":e(()=>[l(a.$slots,"main-content-before")]),"main-content":e(()=>[l(a.$slots,"main-content")]),"main-content-after":e(()=>[l(a.$slots,"main-content-after")]),"main-nav-before":e(()=>[l(a.$slots,"main-nav-before")]),"main-nav-after":e(()=>[l(a.$slots,"main-nav-after")]),comment:e(()=>[l(a.$slots,"comment")]),footer:e(()=>[l(a.$slots,"footer")]),aside:e(()=>[l(a.$slots,"aside")]),"aside-custom":e(()=>[l(a.$slots,"aside-custom")]),default:e(()=>[l(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{O as default,B as usePageData};
