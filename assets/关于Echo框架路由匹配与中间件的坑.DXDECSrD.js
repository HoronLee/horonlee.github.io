import{_ as E}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BKY0BFev.js";import"./chunks/@vueuse/motion.C1YF0VrX.js";import{d as c,u,a as g}from"./chunks/vue-router.B0lpXBWQ.js";import{X as y,b3 as F,b_ as l,be as t,_ as i,a5 as s,bB as b,b5 as m}from"./framework.tSB2Odh-.js";import"./app.CfWrNu88.js";import"./chunks/dayjs.BmWuu2Zz.js";import"./chunks/vue-i18n.CP2UHYEb.js";import"./chunks/pinia.BF0-M7Fk.js";import"./chunks/nprogress.YXB5kar1.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.DoC94HOc.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CBF25nPr.js";import"./post.TKccRjPH.js";const f=c("/posts/关于Echo框架路由匹配与中间件的坑",async h=>JSON.parse('{"title":"关于Echo框架路由匹配与中间件的坑","description":"","frontmatter":{"title":"关于Echo框架路由匹配与中间件的坑","date":"2025-12-25 23:32:32","tags":["Go","Echo"],"categories":["编程笔记"],"cover":null,"dg-publish":false},"headers":[],"relativePath":"pages/posts/关于Echo框架路由匹配与中间件的坑.md","lastUpdated":1767692976000}'),{lazy:(h,e)=>h.name===e.name}),N={__name:"关于Echo框架路由匹配与中间件的坑",setup(h,{expose:e}){const{data:k}=f(),d=u(),p=g(),n=Object.assign(p.meta.frontmatter||{},k.value?.frontmatter||{});return d.currentRoute.value.data=k.value,m("valaxy:frontmatter",n),globalThis.$frontmatter=n,e({frontmatter:{title:"关于Echo框架路由匹配与中间件的坑",date:"2025-12-25 23:32:32",tags:["Go","Echo"],categories:["编程笔记"],cover:null,"dg-publish":!1}}),(a,r)=>{const o=E;return F(),y(o,{frontmatter:b(n)},{"main-content-md":l(()=>[...r[0]||(r[0]=[i("h2",{id:"问题描述",tabindex:"-1"},[s("问题描述 "),i("a",{class:"header-anchor",href:"#问题描述","aria-label":'Permalink to "问题描述"'},"​")],-1),i("p",null,[s("在基于 Echo 框架的 Web 应用中，当访问一个不存在的路由时，返回的是 "),i("code",null,'{"code": 401, "msg": "Token not found"}'),s(" 而不是预期的 "),i("code",null,"404 Not Found"),s("。")],-1),i("h2",{id:"问题背景",tabindex:"-1"},[s("问题背景 "),i("a",{class:"header-anchor",href:"#问题背景","aria-label":'Permalink to "问题背景"'},"​")],-1),i("p",null,"项目采用了公开路由（Public）和私有路由（Private）分组的架构：",-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setupV1RouterGroup"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"VersionedRouterGroup"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    apiGroup "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Group"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/api"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    v1Group "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," apiGroup."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Group"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/v1"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    public "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v1Group."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Group"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'""'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    private "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v1Group."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Group"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'""'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    private."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Use"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(middleware."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"JwtAuth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// JWT认证中间件")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"VersionedRouterGroup"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        PublicRouter:  public,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        PrivateRouter: private,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("两个路由组共享相同的前缀 "),i("code",null,"/api/v1"),s("，其中 "),i("code",null,"private"),s(" 组应用了 JWT 认证中间件。")],-1),i("h2",{id:"问题分析",tabindex:"-1"},[s("问题分析 "),i("a",{class:"header-anchor",href:"#问题分析","aria-label":'Permalink to "问题分析"'},"​")],-1),i("h3",{id:"根本原因",tabindex:"-1"},[s("根本原因 "),i("a",{class:"header-anchor",href:"#根本原因","aria-label":'Permalink to "根本原因"'},"​")],-1),i("p",null,"Echo 框架的路由匹配机制导致了这个问题：",-1),i("ol",null,[i("li",null,[s("当 "),i("code",null,"public"),s(" 和 "),i("code",null,"private"),s(" 两个路由组注册在同一前缀下时，Echo 内部会创建一个通配符路由 "),i("code",null,"/api/v1/*"),s(" 来处理该前缀下的所有请求")]),i("li",null,[s("访问不存在的路由（如 "),i("code",null,"/api/v1/notexist"),s("）时，请求会被通配符路由捕获")]),i("li",null,[s("由于 "),i("code",null,"private"),s(" 组的 JWT 中间件也注册在这个前缀下，请求会先经过 JWT 中间件")]),i("li",null,"JWT 中间件检测到没有 Token，直接返回 401，而不是让框架返回 404")],-1),i("h3",{id:"调试验证",tabindex:"-1"},[s("调试验证 "),i("a",{class:"header-anchor",href:"#调试验证","aria-label":'Permalink to "调试验证"'},"​")],-1),i("p",null,"通过在 JWT 中间件中添加调试日志：",-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"fmt."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Printf"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"DEBUG - Path: '),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"%q"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},", RequestURI: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"%s\\n"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ctx."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Path"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), ctx."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Request"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"().RequestURI)")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("测试不同路径的 "),i("code",null,"ctx.Path()"),s(" 返回值：")],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"请求路径"),i("th",null,[i("code",null,"ctx.Path()")]),i("th",null,"说明")])]),i("tbody",null,[i("tr",null,[i("td",null,[i("code",null,"/api/no-route")]),i("td",null,[i("code",null,'""'),s(" (空)")]),i("td",null,"不在 v1 组下，无匹配")]),i("tr",null,[i("td",null,[i("code",null,"/api/v1/notexist")]),i("td",null,[i("code",null,"/api/v1/*")]),i("td",null,"匹配到兜底通配符")]),i("tr",null,[i("td",null,[i("code",null,"/api/v1/user")]),i("td",null,[i("code",null,"/api/v1/user")]),i("td",null,"匹配到具体路由")])])],-1),i("h2",{id:"解决方案",tabindex:"-1"},[s("解决方案 "),i("a",{class:"header-anchor",href:"#解决方案","aria-label":'Permalink to "解决方案"'},"​")],-1),i("h3",{id:"最终方案-精确匹配兜底通配符",tabindex:"-1"},[s("最终方案：精确匹配兜底通配符 "),i("a",{class:"header-anchor",href:"#最终方案-精确匹配兜底通配符","aria-label":'Permalink to "最终方案：精确匹配兜底通配符"'},"​")],-1),i("p",null,[s("在 JWT 中间件中检查 "),i("code",null,"ctx.Path()"),s(" 是否为兜底通配符路径，如果是则跳过认证：")],-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," JwtAuth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"MiddlewareFunc"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," func"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"next"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"HandlerFunc"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"HandlerFunc"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," func"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ctx"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," echo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Context"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"error"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 如果匹配到 /api/v1/* 兜底通配符，说明没有具体路由匹配")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 跳过认证，让框架返回 404")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 注意：这里精确匹配，不影响真正的通配符路由（如 /api/v1/files/*）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            path "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ctx."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Path"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," path "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," path "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/api/v1/*"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," next"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ctx)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // ... JWT 认证逻辑")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("h3",{id:"为什么用精确匹配而非后缀匹配",tabindex:"-1"},[s("为什么用精确匹配而非后缀匹配？ "),i("a",{class:"header-anchor",href:"#为什么用精确匹配而非后缀匹配","aria-label":'Permalink to "为什么用精确匹配而非后缀匹配？"'},"​")],-1),i("p",null,[s("最初尝试使用 "),i("code",null,'strings.HasSuffix(path, "/*")'),s(" 来检测所有通配符路由，但这会影响真正的业务通配符路由（如 "),i("code",null,"/api/v1/files/*"),s("）。")],-1),i("p",null,[s("精确匹配 "),i("code",null,"/api/v1/*"),s(" 的优势：")],-1),i("ul",null,[i("li",null,"只跳过 Echo 自动生成的兜底通配符"),i("li",null,"不影响业务中真正注册的通配符路由")],-1),i("h3",{id:"关于通配符路由的影响",tabindex:"-1"},[s("关于通配符路由的影响 "),i("a",{class:"header-anchor",href:"#关于通配符路由的影响","aria-label":'Permalink to "关于通配符路由的影响"'},"​")],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"路由类型"),i("th",null,"示例"),i("th",null,"是否受影响")])]),i("tbody",null,[i("tr",null,[i("td",null,"兜底通配符"),i("td",null,[i("code",null,"/api/v1/*")]),i("td",null,"✓ 跳过认证，返回 404")]),i("tr",null,[i("td",null,"业务通配符"),i("td",null,[i("code",null,"/api/v1/files/*")]),i("td",null,"✗ 正常认证")]),i("tr",null,[i("td",null,"业务通配符"),i("td",null,[i("code",null,"/api/v1/static/*")]),i("td",null,"✗ 正常认证")])])],-1),i("p",null,[i("strong",null,"结论"),s("："),i("code",null,"/api/v1/*"),s(" 这种直接挂在版本根路径的通配符在实际业务中几乎不会使用，因为它会匹配所有请求，太宽泛了。业务中的通配符路由一般用于特定资源路径。")],-1),i("h2",{id:"单元测试",tabindex:"-1"},[s("单元测试 "),i("a",{class:"header-anchor",href:"#单元测试","aria-label":'Permalink to "单元测试"'},"​")],-1),i("p",null,"添加了单元测试验证方案的正确性：",-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// TestJwtAuth_NotFoundRoute 测试访问不存在的路由时返回404而非401")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TestJwtAuth_NotFoundRoute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"t"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"testing"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"T"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 测试用例：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 1. 不存在的路由应返回 404")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 2. 存在的路由无 token 应返回 401")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 3. 不在 v1 下的路由应返回 404")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// TestJwtAuth_WildcardRoute 测试真正的通配符路由仍需认证")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TestJwtAuth_WildcardRoute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"t"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"testing"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"T"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 测试用例：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 1. 通配符路由无 token 应返回 401")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 2. 通配符路由根路径无 token 应返回 401")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("测试文件："),i("code",null,"internal/middleware/auth_test.go")],-1),i("h2",{id:"其他尝试过的方案",tabindex:"-1"},[s("其他尝试过的方案 "),i("a",{class:"header-anchor",href:"#其他尝试过的方案","aria-label":'Permalink to "其他尝试过的方案"'},"​")],-1),i("h3",{id:"方案一-使用不同的路由前缀",tabindex:"-1"},[s("方案一：使用不同的路由前缀 "),i("a",{class:"header-anchor",href:"#方案一-使用不同的路由前缀","aria-label":'Permalink to "方案一：使用不同的路由前缀"'},"​")],-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"private "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v1Group."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Group"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/protected"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"缺点：改变了 API URL 结构。",-1),i("h3",{id:"方案二-在路由级别单独应用中间件",tabindex:"-1"},[s("方案二：在路由级别单独应用中间件 "),i("a",{class:"header-anchor",href:"#方案二-在路由级别单独应用中间件","aria-label":'Permalink to "方案二：在路由级别单独应用中间件"'},"​")],-1),i("div",{class:"language-go"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"go"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"routerGroup.PrivateRouter."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"DELETE"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/user"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", h.UserHandler."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"DeleteUser"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), middleware."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"JwtAuth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"缺点：需要在每个私有路由上手动添加中间件，容易遗漏。",-1),i("h3",{id:"方案三-检查-ctx-path",tabindex:"-1"},[s("方案三：检查 "),i("code",null,'ctx.Path() == ""'),s(),i("a",{class:"header-anchor",href:"#方案三-检查-ctx-path","aria-label":'Permalink to "方案三：检查 `ctx.Path() == ""`"'},"​")],-1),i("p",null,[s("根据网上文章建议，检查 "),i("code",null,"ctx.Path()"),s(" 是否为空。")],-1),i("p",null,[s("结果：无效。Echo 在这种情况下返回的是通配符路径 "),i("code",null,"/api/v1/*"),s("，而不是空字符串。")],-1),i("h2",{id:"注意事项",tabindex:"-1"},[s("注意事项 "),i("a",{class:"header-anchor",href:"#注意事项","aria-label":'Permalink to "注意事项"'},"​")],-1),i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"多版本 API"),s("：如果添加了 "),i("code",null,"/api/v2"),s(" 版本，需要在中间件里也加上 "),i("code",null,"/api/v2/*"),s(" 的判断")])]),i("li",null,[i("p",null,[i("strong",null,"中间件错误响应"),s("：建议返回 "),i("code",null,"echo.NewHTTPError()"),s(" 而非直接 "),i("code",null,"ctx.JSON()"),s("，以便统一错误处理")])]),i("li",null,[i("p",null,[i("strong",null,"适用范围"),s("：只有应用在路由组级别的中间件需要这个处理，应用在具体路由上的中间件不需要")])])],-1),i("h2",{id:"修改文件清单",tabindex:"-1"},[s("修改文件清单 "),i("a",{class:"header-anchor",href:"#修改文件清单","aria-label":'Permalink to "修改文件清单"'},"​")],-1),i("ol",null,[i("li",null,[i("code",null,"internal/middleware/auth.go"),s(" - 添加兜底通配符检测逻辑")]),i("li",null,[i("code",null,"internal/middleware/auth_test.go"),s(" - 添加单元测试")]),i("li",null,[i("code",null,"internal/router/router.go"),s(" - 路由组配置（保持原有结构）")])],-1),i("h2",{id:"参考资料",tabindex:"-1"},[s("参考资料 "),i("a",{class:"header-anchor",href:"#参考资料","aria-label":'Permalink to "参考资料"'},"​")],-1),i("ul",null,[i("li",null,[i("a",{href:"https://echo.labstack.com/middleware",target:"_blank",rel:"noreferrer"},"Echo 框架官方文档 - 中间件")]),i("li",null,[i("a",{href:"https://echo.labstack.com/guide/routing",target:"_blank",rel:"noreferrer"},"Echo 框架路由匹配机制")])],-1)])]),"main-header":l(()=>[t(a.$slots,"main-header")]),"main-header-after":l(()=>[t(a.$slots,"main-header-after")]),"main-nav":l(()=>[t(a.$slots,"main-nav")]),"main-content-before":l(()=>[t(a.$slots,"main-content-before")]),"main-content":l(()=>[t(a.$slots,"main-content")]),"main-content-after":l(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[t(a.$slots,"main-nav-after")]),comment:l(()=>[t(a.$slots,"comment")]),footer:l(()=>[t(a.$slots,"footer")]),aside:l(()=>[t(a.$slots,"aside")]),"aside-custom":l(()=>[t(a.$slots,"aside-custom")]),default:l(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{N as default,f as usePageData};
