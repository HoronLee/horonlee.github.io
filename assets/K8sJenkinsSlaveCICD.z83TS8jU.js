import{_ as c}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CVz-OEk3.js";import"./chunks/@vueuse/motion.Bjv2JULu.js";import{e as g,u as E,a as y}from"./chunks/vue-router.CkK6wkE3.js";import{aa as u,al as l,ad as a,ae as i,ai as s,F,ab as B,Z as m}from"./framework.DiIp3j3P.js";import"./app.DYfWnlAw.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.Cqw7qwJJ.js";import"./chunks/pinia.DAg2g0nX.js";import"./chunks/nprogress.QNtX8Req.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.YMmXRdII.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.NFwy7W3t.js";import"./post.DSQTc9o3.js";const f=g("/posts/K8sJenkinsSlaveCICD",async t=>JSON.parse('{"title":"Jenkins的标准用法“Jenkins-Slave”","description":"","frontmatter":{"layout":"post","title":"Jenkins的标准用法“Jenkins-Slave”","date":"2024-05-24 11:42:20","tags":["Linux","Kubernetes","云计算","CICD","Jenkins"],"categories":["云计算","Devops","Jenkins"],"cover":"https://i2.wp.com/digitalvarys.com/wp-content/uploads/2019/05/jenkins-master-slave-config.png?fit=1963%2C1079&ssl=1","password":null,"hide":null},"headers":[],"relativePath":"pages/posts/K8sJenkinsSlaveCICD.md","lastUpdated":1758206429000}'),{lazy:(t,e)=>t.name===e.name}),M={__name:"K8sJenkinsSlaveCICD",setup(t,{expose:e}){const{data:k}=f(),r=y(),o=E(),h=Object.assign(o.meta.frontmatter||{},k.value?.frontmatter||{});return r.currentRoute.value.data=k.value,m("valaxy:frontmatter",h),globalThis.$frontmatter=h,e({frontmatter:{layout:"post",title:"Jenkins的标准用法“Jenkins-Slave”",date:"2024-05-24 11:42:20",tags:["Linux","Kubernetes","云计算","CICD","Jenkins"],categories:["云计算","Devops","Jenkins"],cover:"https://i2.wp.com/digitalvarys.com/wp-content/uploads/2019/05/jenkins-master-slave-config.png?fit=1963%2C1079&ssl=1",password:null,hide:null}}),(n,p)=>{const d=c;return B(),u(d,{frontmatter:F(h)},{"main-content-md":l(()=>[...p[0]||(p[0]=[i("h1",{id:"kubernetes构建-jenkins-master-slave-架构",tabindex:"-1"},[s("kubernetes构建 Jenkins-Master&Slave 架构 "),i("a",{class:"header-anchor",href:"#kubernetes构建-jenkins-master-slave-架构","aria-label":'Permalink to "kubernetes构建 Jenkins-Master&Slave 架构"'},"​")],-1),i("h2",{id:"引子",tabindex:"-1"},[s("引子 "),i("a",{class:"header-anchor",href:"#引子","aria-label":'Permalink to "引子"'},"​")],-1),i("p",null,"这篇文章是我在学校帮助专业老师撰写的，旨在于帮助同学更好的学习 Jenkins 的使用，所有内容都是基于最新的官方文档编写，且经过检验，可以放心食用！",-1),i("p",null,"下面就是正文了，enjoy:D",-1),i("h2",{id:"准备工作",tabindex:"-1"},[s("准备工作 "),i("a",{class:"header-anchor",href:"#准备工作","aria-label":'Permalink to "准备工作"'},"​")],-1),i("p",null,"虚拟机节点信息：",-1),i("ul",null,[i("li",null,[i("p",null,"master 节点：172.30.26.172"),i("ul",null,[i("li",null,[i("p",null,"4 个 vCPU")]),i("li",null,[i("p",null,"4G 内存")])])]),i("li",null,[i("p",null,"worker1节点：172.30.26.173（标记为 worker tag，pod 主动在此节点运行）"),i("ul",null,[i("li",null,"8 个 vCPU"),i("li",null,"16G 内存（12G 内存足够）")])])],-1),i("p",null,"相关镜像：",-1),i("ol",null,[i("li",null,[s("["),i("a",{href:"https://hub.docker.com/r/jenkins/jenkins",target:"_blank",rel:"noreferrer"},"jenkins/jenkins - Docker Image | Docker Hub"),s("]("),i("a",{href:"https://hub.docker.com/_/jenkins",target:"_blank",rel:"noreferrer"},"https://hub.docker.com/_/jenkins"),s(")")]),i("li",null,[i("a",{href:"https://hub.docker.com/r/jenkins/inbound-agent/",target:"_blank",rel:"noreferrer"},"jenkins/inbound-agent - Docker 镜像 |Docker 中心")]),i("li",null,[i("a",{href:"https://hub.docker.com/r/gitlab/gitlab-ce",target:"_blank",rel:"noreferrer"},"gitlab/gitlab-ce - Docker Image | Docker Hub")])],-1),i("p",null,[s("所用项目："),i("a",{href:"https://github.com/YunYouJun/valaxy",target:"_blank",rel:"noreferrer"},"YunYouJun/valaxy: 🌌 Next Generation Static Blog Framework (Beta) 下一代静态博客框架（支持页面/配置热重载） (github.com)"),s("，本文更改了 Dockerfile，删除了第一阶段的构建！")],-1),i("hr",null,null,-1),i("p",null,[s("将 master 节点的"),i("code",null,".kube"),s("配置文件拷贝到 worker1 节点，方便后续的工作")],-1),i("p",null,[i("code",null,"scp -r /root/.kube worker1:/root")],-1),i("h3",{id:"设置jenkinsmaster容忍度",tabindex:"-1"},[s("设置JenkinsMaster容忍度 "),i("a",{class:"header-anchor",href:"#设置jenkinsmaster容忍度","aria-label":'Permalink to "设置JenkinsMaster容忍度"'},"​")],-1),i("blockquote",null,[i("p",null,"kubernetes 在安装完成后会在 master 节点添加一个名为 control-plane 的污点，这个污点不会容忍任何非指定的 pod 运行在 master 节点，但是我们需要讲 jenkins-master 安排在 master 节点，该怎么做呢？以下是处理思路。")],-1),i("p",null,[s("最简单的方法就是移除所有节点的 control-plane 污点 "),i("code",null,"kubectl taint nodes --all node-role.kubernetes.io/control-plane-"),s("，然后再指定"),i("code",null,"nodeSelector"),s("。(nodeSelector的用法看第二种方法)")],-1),i("blockquote",null,[i("p",null,"还有一种方法我更推荐，在生产环境也可以这样操作：")],-1),i("p",null,[s("为 master 节点打上标签"),i("code",null,"jenkins=master"),s("："),i("code",null,"kubectl label no master jenkins=master")],-1),i("p",null,"在创建 jenkins-master 的时候使用标签选择器，就可以强制让 pod 运行在有 NoSchedule 的Taints 的主节点上",-1),i("p",null,[s("但是此时还是不能让 pod 成功调度到 master 节点，因为 master 节点在初始化时就被标记了"),i("a",{href:"https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/taint-and-toleration/",target:"_blank",rel:"noreferrer"},"污点"),s("“node-role.kubernetes.io/control-plane”，所以我们需要为 master 节点配置容忍度，允许拥有特定键值对标签的 pod 运行在这个节点上。")],-1),i("p",null,[s("所以需要在"),i("code",null,"spec.template.spec"),s("配置以下内容：")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"nodeSelector"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  jenkins"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"master"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"tolerations"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"key"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"node-role.kubernetes.io/control-plane"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    operator"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Exists"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    effect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"NoSchedule"')])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("blockquote",null,[i("p",null,"设置HTTP访问镜像仓库（所有节点都要做）：/etc/containerd/config")],-1),i("p",null,"Containerd从v1.5之后就不推荐了以config.toml作为镜像仓库的配置文件，这里我们采用新的配置方法",-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mkdir"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -p"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/containerd/certs.d/172.30.26.172")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"vim"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/containerd/certs.d/172.30.26.172/hosts.toml")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"在文件中写入以下内容",-1),i("div",{class:"language-toml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"toml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"server = "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http://172.30.26.172"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"host"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'"http://172'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"30"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"26"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},'172"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"capabilities = ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"pull"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"resolve"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"push"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"skip_verify = "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("然后重启 "),i("code",null,"systemctl restart containerd ")],-1),i("h2",{id:"安装-harbor-镜像仓库",tabindex:"-1"},[s("安装 Harbor 镜像仓库 "),i("a",{class:"header-anchor",href:"#安装-harbor-镜像仓库","aria-label":'Permalink to "安装 Harbor 镜像仓库"'},"​")],-1),i("blockquote",null,[i("p",null,[s("官方下载地址："),i("a",{href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noreferrer"},"Releases · goharbor/harbor (github.com)")])],-1),i("p",null,"将harbor-offline-installer-v2.9.4.tgz下载到opt目录下",-1),i("p",null,[i("code",null,"curl -O http://172.30.27.143/CICD/harbor-offline-installer-v2.9.4.tgz")],-1),i("p",null,[s("解压文件"),i("code",null,"tar xvf harbor-offline-installer-v2.9.4.tgz")],-1),i("p",null,[s("进入harbor安装目录"),i("code",null,"cd harbor")],-1),i("p",null,[s("编写安装配"),i("code",null,"cp harbor.yml.tmpl harbor.yml")],-1),i("p",null,[i("code",null,"vim harbor.yml")],-1),i("p",null,"将第五行hostname:后面的IP改为Master节点IP",-1),i("p",null,[i("code",null,"hostname: http://172.30.26.172/")],-1),i("p",null,"删除里面13-18行以取消https配置",-1),i("p",null,[s("执行脚本来安装harbor"),i("code",null,"./install.sh")],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164017314.png",alt:"image-20240930101917466",loading:"lazy",decoding:"async"})],-1),i("p",null,"出现如图回显说明Harbor安装完成",-1),i("p",null,"访问Harbor",-1),i("p",null,[i("a",{href:"http://172.30.26.172/",target:"_blank",rel:"noreferrer"},"http://172.30.26.172/")],-1),i("p",null,"​ 账号：admin",-1),i("p",null,"​ 密码：Harbor12345",-1),i("p",null,"登录 Harbor 仓库",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"[root@master ~]# docker login 172.30.26.172")]),s(`
`),i("span",{class:"line"},[i("span",null,"Username: admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"Password: ")]),s(`
`),i("span",{class:"line"},[i("span",null,"WARNING! Your password will be stored unencrypted in /root/.docker/config.json.")]),s(`
`),i("span",{class:"line"},[i("span",null,"Configure a credential helper to remove this warning. See")]),s(`
`),i("span",{class:"line"},[i("span",null,"https://docs.docker.com/engine/reference/commandline/login/#credentials-store")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("h2",{id:"部署-gitea",tabindex:"-1"},[s("部署 Gitea "),i("a",{class:"header-anchor",href:"#部署-gitea","aria-label":'Permalink to "部署 Gitea"'},"​")],-1),i("blockquote",null,[i("p",null,[s("什么是 Gitea？Gitea 是一个轻量级的 DevOps 平台软件。从开发计划到产品成型的整个软件生命周期，他都能够高效而轻松的帮助团队和开发者。包括 Git 托管、代码审查、团队协作、软件包注册和 CI/CD。它与 GitHub、Bitbucket 和 GitLab 等比较类似。 Gitea 最初是从 "),i("a",{href:"http://gogs.io/",target:"_blank",rel:"noreferrer"},"Gogs"),s(" 分支而来，几乎所有代码都已更改。对于我们Fork的原因可以看 "),i("a",{href:"https://blog.gitea.com/welcome-to-gitea/",target:"_blank",rel:"noreferrer"},"这里"),s("。")])],-1),i("h3",{id:"使用-docker-安装-gitea",tabindex:"-1"},[s("使用 docker 安装 Gitea "),i("a",{class:"header-anchor",href:"#使用-docker-安装-gitea","aria-label":'Permalink to "使用 docker 安装 Gitea"'},"​")],-1),i("p",null,"⚠️Gitea 部署在 worker1 节点",-1),i("p",null,"在 root 目录下创建文件夹 gitea，并进入，创建 docker-compose.yaml 文件并编辑",-1),i("p",null,[i("code",null,"mkdir gitea && cd gitea && vim docker-compose.yaml")],-1),i("div",{class:"language-yaml"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"yaml"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"3"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"networks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  gitea"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    external"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"services"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  server"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    image"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"gitea/gitea:1.21.11")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    container_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    environment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"USER_UID=1000")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"USER_GID=1000")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"GITEA__database__DB_TYPE=mysql")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"GITEA__database__HOST=db:3306")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"GITEA__database__NAME=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"GITEA__database__USER=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"GITEA__database__PASSWD=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    restart"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"always")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    networks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    volumes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"./gitea:/data")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/etc/timezone:/etc/timezone:ro")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/etc/localtime:/etc/localtime:ro")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    ports"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"3000:3000"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"222:22"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    depends_on"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"db")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    image"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysql:5.7.39")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    restart"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"always")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    environment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"MYSQL_ROOT_PASSWORD=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"MYSQL_USER=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"MYSQL_PASSWORD=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"MYSQL_DATABASE=gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    networks"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"gitea")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    volumes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"./mysql:/var/lib/mysql")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("启动 docker compose："),i("code",null,"docker compose up -d")],-1),i("p",null,[s("看到 docker compose 都启动之后，进入网页进行安装"),i("a",{href:"http://172.30.26.173:3000/",target:"_blank",rel:"noreferrer"},"http://172.30.26.173:3000/")],-1),i("p",null,"编辑数据库的连接配置（默认可以不改），设置管理员信息",-1),i("ul",null,[i("li",null,"管理员用户名root"),i("li",null,"电子邮件admin@example.com"),i("li",null,"密码 000000")],-1),i("p",null,[s("然后点击 "),i("code",null,"立即安装"),s("，稍等片刻即可进入登录页面，输入账号密码，进入主页")],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164025311.png",alt:"image-20240930101931037",loading:"lazy",decoding:"async"})],-1),i("h3",{id:"使用-helm-安装gitea",tabindex:"-1"},[s("使用 Helm 安装Gitea "),i("a",{class:"header-anchor",href:"#使用-helm-安装gitea","aria-label":'Permalink to "使用 Helm 安装Gitea"'},"​")],-1),i("blockquote",null,[i("p",null,"安装 Helm")],-1),i("p",null,[s("什么是 "),i("a",{href:"https://helm.sh/zh/docs/intro/quickstart/",target:"_blank",rel:"noreferrer"},"Helm |快速入门指南 (helm.sh)"),s("？")],-1),i("ol",null,[i("li",null,[i("code",null,"wget http://172.30.27.143/CICD/helm-v3.15.0-linux-amd64.tar.gz")]),i("li",null,[i("code",null,"tar zxf helm-v3.15.0-linux-amd64.tar.gz")]),i("li",null,[i("code",null,"mv linux-amd64/helm /usr/local/bin/helm")]),i("li",null,[i("code",null,"rm -rf linux-amd64/")])],-1),i("blockquote",null,[i("p",null,"安装 Gitea")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," repo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gitea"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://dl.gitea.com/charts")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," repo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gitea"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," gitea/gitea")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("h2",{id:"新建-git-项目",tabindex:"-1"},[s("新建 Git 项目 "),i("a",{class:"header-anchor",href:"#新建-git-项目","aria-label":'Permalink to "新建 Git 项目"'},"​")],-1),i("p",null,[s("点击仓库列表边上的➕号，开始添加仓库的步骤，名称填写 "),i("code",null,"valaxy"),s("，然后直接点击最下面的按钮新建仓库")],-1),i("h3",{id:"创建本地项目",tabindex:"-1"},[s("创建本地项目 "),i("a",{class:"header-anchor",href:"#创建本地项目","aria-label":'Permalink to "创建本地项目"'},"​")],-1),i("p",null,[s("下载项目 wget "),i("a",{href:"http://172.30.27.143/CICD/jenkins-slave/ValaxyBlogProject.tar.gz",target:"_blank",rel:"noreferrer"},"http://172.30.27.143/CICD/jenkins-slave/ValaxyBlogProject.tar.gz")],-1),i("p",null,[s("解压项目 "),i("code",null,"tar zxf valaxy-blog.tar.gz")],-1),i("p",null,[s("进入项目文件 "),i("code",null,"cd valaxy-blog")],-1),i("h3",{id:"上传项目",tabindex:"-1"},[s("上传项目 "),i("a",{class:"header-anchor",href:"#上传项目","aria-label":'Permalink to "上传项目"'},"​")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," init")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," checkout"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -b"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," .")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," commit"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -m"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "first commit"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," remote"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," add"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," origin"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://172.30.26.173:3000/root/valaxy.git")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," origin"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@master valaxy-blog]# git push -u origin main")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Username"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," for"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'http://172.30.26.173:3000':"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," root"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"	//输入之前的账号密码即可")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Password"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," for"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'http://root@172.30.26.173:3000':"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Counting"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," objects:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 56,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," done.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Delta"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," compression"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," using"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," up"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," to"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," threads.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Compressing"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," objects:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 100%"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (41/41), done.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Writing"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," objects:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 100%"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (56/56), 101.45 KiB "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," 0"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," bytes/s,"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," done.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Total"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 56"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (delta "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"), reused 0 ("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"delta"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"remote:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ."),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Processing"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," references")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"remote:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Processed"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," references"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," total")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"To"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://172.30.26.173:3000/root/valaxy.git")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [new "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"branch]"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"      main"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," -"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"分支"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 设置为跟踪来自"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," origin"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 的远程分支"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," main。")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"刷新 gitea 网页，即可看到项目上传完成",-1),i("h2",{id:"安装jenkins-master",tabindex:"-1"},[s("安装Jenkins-Master "),i("a",{class:"header-anchor",href:"#安装jenkins-master","aria-label":'Permalink to "安装Jenkins-Master"'},"​")],-1),i("h3",{id:"配置-nfs",tabindex:"-1"},[s("配置 NFS "),i("a",{class:"header-anchor",href:"#配置-nfs","aria-label":'Permalink to "配置 NFS"'},"​")],-1),i("p",null,"安装NFS服务（这个需要在所有K8S的节点上安装）",-1),i("p",null,[i("code",null,"yum install -y nfs-utils")],-1),i("p",null,"创建共享目录（这个只需要在master节点）",-1),i("p",null,[i("code",null,"mkdir -p /opt/nfs/jenkins")],-1),i("p",null,"编写NFS的共享配置",-1),i("p",null,[i("code",null,"vim /etc/exports")],-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"/opt/nfs/jenkins *(rw,no_root_squash)")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("code",null,"*"),s("代表对所有IP都开放此目录，"),i("code",null,"rw"),s("是读写，"),i("code",null,"no_root_squash"),s("不压制root权限")],-1),i("p",null,"启动服务",-1),i("p",null,[i("code",null,"systemctl enable nfs --now")],-1),i("p",null,"查看NFS共享目录",-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@master "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# showmount -e 172.30.26.172")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Export"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," list"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," for"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 172.30.26.172:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"/opt/nfs/jenkins"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," *")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("hr",null,null,-1),i("p",null,"创建并进入jenkins目录",-1),i("p",null,[i("code",null,"mkdir jenkins && cd jenkins")],-1),i("p",null,[i("strong",null,"步骤 1"),s("：为 Jenkins 创建命名空间。 最好将所有 DevOps 工具分类为与其他应用程序不同的命名空间。")],-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl create namespace devops")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"**步骤2：**创建“serviceAccount.yaml”文件并复制以下管理员服务帐户清单。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"apiVersion: rbac.authorization.k8s.io/v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: ClusterRole")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"rules:")]),s(`
`),i("span",{class:"line"},[i("span",null,'  - apiGroups: [""]')]),s(`
`),i("span",{class:"line"},[i("span",null,'    resources: ["*"]')]),s(`
`),i("span",{class:"line"},[i("span",null,'    verbs: ["*"]')]),s(`
`),i("span",{class:"line"},[i("span",null,"---")]),s(`
`),i("span",{class:"line"},[i("span",null,"apiVersion: v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: ServiceAccount")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"  namespace: devops")]),s(`
`),i("span",{class:"line"},[i("span",null,"---")]),s(`
`),i("span",{class:"line"},[i("span",null,"apiVersion: rbac.authorization.k8s.io/v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: ClusterRoleBinding")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"roleRef:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  apiGroup: rbac.authorization.k8s.io")]),s(`
`),i("span",{class:"line"},[i("span",null,"  kind: ClusterRole")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"subjects:")]),s(`
`),i("span",{class:"line"},[i("span",null,"- kind: ServiceAccount")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"  namespace: devops")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"“serviceAccount.yaml”创建一个“jenkins-admin”集群角色，“jenkins-admin”服务帐户，并将“clusterRole”绑定到服务帐户。",-1),i("p",null,"“jenkins-admin”群集角色具有管理群集组件的所有权限。 您还可以通过指定单个资源操作来限制访问。",-1),i("p",null,"现在使用 kubectl 创建服务帐户。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl apply -f serviceAccount.yaml")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[i("strong",null,"步骤3："),s(" 创建“volume.yaml”并复制以下持久卷清单。")],-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kind: StorageClass")]),s(`
`),i("span",{class:"line"},[i("span",null,"apiVersion: storage.k8s.io/v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: local-storage")]),s(`
`),i("span",{class:"line"},[i("span",null,"provisioner: kubernetes.io/no-provisioner")]),s(`
`),i("span",{class:"line"},[i("span",null,"volumeBindingMode: WaitForFirstConsumer")]),s(`
`),i("span",{class:"line"},[i("span",null,"---")]),s(`
`),i("span",{class:"line"},[i("span",null,"apiVersion: v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: PersistentVolume")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-pv-volume")]),s(`
`),i("span",{class:"line"},[i("span",null,"  labels:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    type: local")]),s(`
`),i("span",{class:"line"},[i("span",null,"spec:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  storageClassName: local-storage")]),s(`
`),i("span",{class:"line"},[i("span",null,"  claimRef:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    name: jenkins-pv-claim")]),s(`
`),i("span",{class:"line"},[i("span",null,"    namespace: devops")]),s(`
`),i("span",{class:"line"},[i("span",null,"  capacity:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    storage: 10Gi")]),s(`
`),i("span",{class:"line"},[i("span",null,"  accessModes:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    - ReadWriteOnce")]),s(`
`),i("span",{class:"line"},[i("span",null,"  local:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    path: /opt/nfs/jenkins	#之前设置的nfs存储目录")]),s(`
`),i("span",{class:"line"},[i("span",null,"  nodeAffinity:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    required:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      nodeSelectorTerms:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      - matchExpressions:")]),s(`
`),i("span",{class:"line"},[i("span",null,"        - key: kubernetes.io/hostname")]),s(`
`),i("span",{class:"line"},[i("span",null,"          operator: In")]),s(`
`),i("span",{class:"line"},[i("span",null,"          values:")]),s(`
`),i("span",{class:"line"},[i("span",null,"          - master	#Master节点主机名")]),s(`
`),i("span",{class:"line"},[i("span",null,"---")]),s(`
`),i("span",{class:"line"},[i("span",null,"apiVersion: v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: PersistentVolumeClaim")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-pv-claim")]),s(`
`),i("span",{class:"line"},[i("span",null,"  namespace: devops")]),s(`
`),i("span",{class:"line"},[i("span",null,"spec:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  storageClassName: local-storage")]),s(`
`),i("span",{class:"line"},[i("span",null,"  accessModes:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    - ReadWriteOnce")]),s(`
`),i("span",{class:"line"},[i("span",null,"  resources:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    requests:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      storage: 3Gi")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"对于卷，我们使用“本地”存储类进行演示。 这意味着，它会在“/opt/nfs/jenkins”位置下的特定节点中创建一个“PersistentVolume”卷。",-1),i("p",null,"由于“本地”存储类需要节点选择器，因此您需要正确指定工作节点名称，以便将 Jenkins Pod 调度到特定节点中。",-1),i("p",null,"如果 Pod 被删除或重新启动，数据将保留在节点卷中。 但是，如果节点被删除，您将丢失所有数据。",-1),i("p",null,"理想情况下，应使用云提供商提供的可用存储类或群集管理员提供的存储类来使用持久性卷，以便在节点故障时保留数据。",-1),i("p",null,"让我们使用 kubectl 创建卷",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl create -f volume.yaml")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"**步骤4：**创建名为“deployment.yaml”的部署文件，并复制以下部署清单。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"apiVersion: apps/v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: Deployment")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins")]),s(`
`),i("span",{class:"line"},[i("span",null,"  namespace: devops")]),s(`
`),i("span",{class:"line"},[i("span",null,"spec:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  replicas: 1")]),s(`
`),i("span",{class:"line"},[i("span",null,"  selector:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    matchLabels:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      app: jenkins-server")]),s(`
`),i("span",{class:"line"},[i("span",null,"  template:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      labels:")]),s(`
`),i("span",{class:"line"},[i("span",null,"        app: jenkins-server")]),s(`
`),i("span",{class:"line"},[i("span",null,"    spec:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      nodeSelector:")]),s(`
`),i("span",{class:"line"},[i("span",null,'        jenkins: "master"')]),s(`
`),i("span",{class:"line"},[i("span",null,"      tolerations:")]),s(`
`),i("span",{class:"line"},[i("span",null,'      - key: "node-role.kubernetes.io/control-plane"')]),s(`
`),i("span",{class:"line"},[i("span",null,'        operator: "Exists"')]),s(`
`),i("span",{class:"line"},[i("span",null,'        effect: "NoSchedule"')]),s(`
`),i("span",{class:"line"},[i("span",null,"      securityContext:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            fsGroup: 1000")]),s(`
`),i("span",{class:"line"},[i("span",null,"            runAsUser: 1000")]),s(`
`),i("span",{class:"line"},[i("span",null,"      serviceAccountName: jenkins-admin")]),s(`
`),i("span",{class:"line"},[i("span",null,"      containers:")]),s(`
`),i("span",{class:"line"},[i("span",null,"        - name: jenkins")]),s(`
`),i("span",{class:"line"},[i("span",null,"          image: docker.io/jenkins/jenkins:latest")]),s(`
`),i("span",{class:"line"},[i("span",null,"          imagePullPolicy: IfNotPresent")]),s(`
`),i("span",{class:"line"},[i("span",null,"          resources:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            limits:")]),s(`
`),i("span",{class:"line"},[i("span",null,'              memory: "2Gi"')]),s(`
`),i("span",{class:"line"},[i("span",null,'              cpu: "1000m"')]),s(`
`),i("span",{class:"line"},[i("span",null,"            requests:")]),s(`
`),i("span",{class:"line"},[i("span",null,'              memory: "500Mi"')]),s(`
`),i("span",{class:"line"},[i("span",null,'              cpu: "500m"')]),s(`
`),i("span",{class:"line"},[i("span",null,"          ports:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            - name: httpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"              containerPort: 8080")]),s(`
`),i("span",{class:"line"},[i("span",null,"            - name: jnlpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"              containerPort: 50000")]),s(`
`),i("span",{class:"line"},[i("span",null,"          livenessProbe:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            httpGet:")]),s(`
`),i("span",{class:"line"},[i("span",null,'              path: "/login"')]),s(`
`),i("span",{class:"line"},[i("span",null,"              port: 8080")]),s(`
`),i("span",{class:"line"},[i("span",null,"            initialDelaySeconds: 90")]),s(`
`),i("span",{class:"line"},[i("span",null,"            periodSeconds: 10")]),s(`
`),i("span",{class:"line"},[i("span",null,"            timeoutSeconds: 5")]),s(`
`),i("span",{class:"line"},[i("span",null,"            failureThreshold: 5")]),s(`
`),i("span",{class:"line"},[i("span",null,"          readinessProbe:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            httpGet:")]),s(`
`),i("span",{class:"line"},[i("span",null,'              path: "/login"')]),s(`
`),i("span",{class:"line"},[i("span",null,"              port: 8080")]),s(`
`),i("span",{class:"line"},[i("span",null,"            initialDelaySeconds: 60")]),s(`
`),i("span",{class:"line"},[i("span",null,"            periodSeconds: 10")]),s(`
`),i("span",{class:"line"},[i("span",null,"            timeoutSeconds: 5")]),s(`
`),i("span",{class:"line"},[i("span",null,"            failureThreshold: 3")]),s(`
`),i("span",{class:"line"},[i("span",null,"          volumeMounts:")]),s(`
`),i("span",{class:"line"},[i("span",null,"            - name: jenkins-data")]),s(`
`),i("span",{class:"line"},[i("span",null,"              subPath: jenkinsMaster")]),s(`
`),i("span",{class:"line"},[i("span",null,"              mountPath: /var/jenkins_home")]),s(`
`),i("span",{class:"line"},[i("span",null,"      volumes:")]),s(`
`),i("span",{class:"line"},[i("span",null,"        - name: jenkins-data")]),s(`
`),i("span",{class:"line"},[i("span",null,"          persistentVolumeClaim:")]),s(`
`),i("span",{class:"line"},[i("span",null,"              claimName: jenkins-pv-claim")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"在此 Jenkins Kubernetes 部署中，我们使用了以下内容：",-1),i("ol",null,[i("li",null,"“securityContext”，以便 Jenkins pod 能够写入本地持久卷。"),i("li",null,"用于监视 Jenkins pod 运行状况的 Liveness and readiness 探测。"),i("li",null,"基于保存 Jenkins 数据路径“/var/jenkins_home”的本地存储类的本地持久性卷。")],-1),i("p",null,"使用 kubectl 创建部署。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl apply -f deployment.yaml")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"检查部署状态。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl get deployments -n devops")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"现在，您可以使用以下命令获取部署详细信息。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl describe deployments --namespace=devops")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("h3",{id:"使用-kubernetes-服务访问-jenkins",tabindex:"-1"},[s("使用 Kubernetes 服务访问 Jenkins "),i("a",{class:"header-anchor",href:"#使用-kubernetes-服务访问-jenkins","aria-label":'Permalink to "使用 Kubernetes 服务访问 Jenkins"'},"​")],-1),i("p",null,"现在，我们已经创建了一个部署。 但是，它不对外界开放。 为了从外部世界访问 Jenkins 部署，我们需要创建一个服务并将其映射到部署。",-1),i("p",null,"创建“service.yaml”并复制以下服务清单：",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"apiVersion: v1")]),s(`
`),i("span",{class:"line"},[i("span",null,"kind: Service")]),s(`
`),i("span",{class:"line"},[i("span",null,"metadata:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  name: jenkins-service")]),s(`
`),i("span",{class:"line"},[i("span",null,"  namespace: devops")]),s(`
`),i("span",{class:"line"},[i("span",null,"  annotations:")]),s(`
`),i("span",{class:"line"},[i("span",null,"      prometheus.io/scrape: 'true'")]),s(`
`),i("span",{class:"line"},[i("span",null,"      prometheus.io/path:   /")]),s(`
`),i("span",{class:"line"},[i("span",null,"      prometheus.io/port:   '8080'")]),s(`
`),i("span",{class:"line"},[i("span",null,"spec:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  selector:")]),s(`
`),i("span",{class:"line"},[i("span",null,"    app: jenkins-server")]),s(`
`),i("span",{class:"line"},[i("span",null,"  type: NodePort")]),s(`
`),i("span",{class:"line"},[i("span",null,"  ports:")]),s(`
`),i("span",{class:"line"},[i("span",null,"  - name: httpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"    port: 8080")]),s(`
`),i("span",{class:"line"},[i("span",null,"    targetPort: httpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"    nodePort: 32000")]),s(`
`),i("span",{class:"line"},[i("span",null,"  - name: jnlpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"    port: 50000")]),s(`
`),i("span",{class:"line"},[i("span",null,"    targetPort: jnlpport")]),s(`
`),i("span",{class:"line"},[i("span",null,"    nodePort: 32500")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"使用 kubectl 创建 Jenkins 服务。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"kubectl apply -f service.yaml")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,"现在，当浏览到端口 32000 上的任何一个节点 IP 时，您将能够访问 Jenkins 仪表板。",-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"http://<master-ip>:32000")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("查看 jenkins 的 pod 在 running 状态，通过"),i("a",{href:"http://172.30.26.172:32000/%E8%AE%BF%E9%97%AE",target:"_blank",rel:"noreferrer"},"http://172.30.26.172:32000/访问"),s(" jenkins")],-1),i("p",null,[s("查看 jenkins 初始密码"),i("code",null,"cat /opt/nfs/jenkins/jenkinsMaster/secrets/initialAdminPassword")],-1),i("p",null,"创建用户，然后选择保存并完成",-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164037518.png",alt:"image-20240930101945192",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164041800.png",alt:"image-20240930101950980",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164047338.png",alt:"image-20240930101956943",loading:"lazy",decoding:"async"})],-1),i("p",null,"设置全局安全设置为任何用户可以做任何事",-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164051630.png",alt:"image-20240930102002606",loading:"lazy",decoding:"async"})],-1),i("h3",{id:"安装插件",tabindex:"-1"},[s("安装插件 "),i("a",{class:"header-anchor",href:"#安装插件","aria-label":'Permalink to "安装插件"'},"​")],-1),i("p",null,"前往 系统管理-插件管理-Available plugins，搜索Kubernetes和Docker这两个插件，都进行安装，可以选择性安装Blue Ocean，这样可以更好的观察流水线的运作",-1),i("h2",{id:"配置-jankinscloud",tabindex:"-1"},[s("配置 JankinsCloud "),i("a",{class:"header-anchor",href:"#配置-jankinscloud","aria-label":'Permalink to "配置 JankinsCloud"'},"​")],-1),i("blockquote",null,[i("p",null,"⚠️注意，所有 IP 地址请改为master 节点的 IP")],-1),i("p",null,[s("进入cloud 节点配置页面"),i("a",{href:"http://172.30.26.172:32000/manage/cloud/%EF%BC%88%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86-Clouds-New",target:"_blank",rel:"noreferrer"},"http://172.30.26.172:32000/manage/cloud/（系统管理-Clouds-New"),s(" cloud）")],-1),i("p",null,"点击 New Cloud",-1),i("ul",null,[i("li",null,[i("p",null,[s("Cloud Name "),i("code",null,"worker1")])]),i("li",null,[i("p",null,[s("Type "),i("code",null,"Kubernetes")])])],-1),i("p",null,"进入下一步",-1),i("ul",null,[i("li",null,[i("p",null,[s("在终端输入"),i("code",null,"kubectl cluster-info"),s("获得 ApiServer 的地址"),i("a",{href:"https://172.30.26.172:6443",target:"_blank",rel:"noreferrer"},"https://172.30.26.172:6443")])]),i("li",null,[i("p",null,[s("Kubernetes 地址"),i("code",null,"https://172.30.26.172:6443")])]),i("li",null,[i("p",null,[s("Kubernetes 服务证书 key填写"),i("code",null,".kube/config"),s("中"),i("code",null,"certificate-authority-data:"),s("字段的密钥")])])],-1),i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"LS0tLS1CRUdJTiBDRVJUSUZJ...(省略)")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("ul",null,[i("li",null,[i("p",null,[s("勾选"),i("code",null,"禁用 HTTPS 证书检查")])]),i("li",null,[i("p",null,[s("Kubernetes 命名空间"),i("code",null,"devops")])])],-1),i("p",null,[s("点击"),i("code",null,"连接测试"),s("，显示"),i("code",null,"Connected to Kubernetes v1.29.0"),s("即可")],-1),i("hr",null,null,-1),i("ul",null,[i("li",null,[i("p",null,[s("Jenkins 地址"),i("code",null,"http://172.30.26.172:32000/")])]),i("li",null,[i("p",null,[s("Jenkins 通道"),i("code",null,"172.30.26.172:32500"),s("不能加任何协议，因为是 tcp 传输协议，值就是 jenkins service 的另一个暴露的端口")])])],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164059202.png",alt:"image-20240930102035817",loading:"lazy",decoding:"async"})],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164104283.png",alt:"image-20240930102040791",loading:"lazy",decoding:"async"})],-1),i("p",null,"最后点击下方 Save 保存",-1),i("h2",{id:"配置-jankins-slave",tabindex:"-1"},[s("配置 Jankins-Slave "),i("a",{class:"header-anchor",href:"#配置-jankins-slave","aria-label":'Permalink to "配置 Jankins-Slave"'},"​")],-1),i("p",null,[s("在 Jankins-Slave 架构中，Slave 节点通常由 "),i("code",null,"jenkins/inbound-agent"),s(" 镜像直接生成，在流水线完成后，此节点就会被删除，因为本项目需要构建的是 vite 项目，所以我们需要自定义一个 Slave 节点的镜像，以便项目的构建")],-1),i("h3",{id:"构建特殊的-agent-镜像",tabindex:"-1"},[s("构建特殊的 agent 镜像 "),i("a",{class:"header-anchor",href:"#构建特殊的-agent-镜像","aria-label":'Permalink to "构建特殊的 agent 镜像"'},"​")],-1),i("p",null,[s("在 root 目录创建"),i("code",null,"inbound-agent-node"),s("目录，在此目录完成镜像构建 "),i("code",null,"cd inbound-agent-node")],-1),i("p",null,[s("下载 nodejs 程序 "),i("code",null,"wget https://nodejs.org/dist/v20.13.1/node-v20.13.1-linux-x64.tar.xz")],-1),i("p",null,"编辑 Dockerfile",-1),i("p",null,[i("code",null,"vim inbound-agent-node-Dockerfile")],-1),i("div",{class:"language-dockerfile"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"dockerfile"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"FROM"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," jenkins/inbound-agent")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"USER"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," root")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WORKDIR"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /usr/local")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ADD"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node-v20.13.1-linux-x64.tar.xz .")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ENV"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PATH="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/usr/local/node-v20.13.1-linux-x64/bin:${PATH}"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RUN"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," npm config set registry https://registry.npmmirror.com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RUN"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," npm install -g pnpm")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ENTRYPOINT"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jenkins-agent"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("构建镜像，镜像的 tag 前面的"),i("strong",null,"地址"),s("需要改成自己的 "),i("strong",null,"Harbor 仓库地址")],-1),i("p",null,[i("code",null,"docker build -t 172.30.26.172/library/inbound-agent-node:latest . -f inbound-agent-node-Dockerfile")],-1),i("p",null,[s("推送到 Harbor "),i("code",null,"docker push 172.30.26.172/library/inbound-agent-node:latest")],-1),i("p",null,[s("在 "),i("code",null,"worker1"),s(" 节点拉取这个镜像 "),i("code",null,"ctr -n k8s.io image pull --plain-http 172.30.26.172/library/inbound-agent-node:latest")],-1),i("h3",{id:"设置-pod-template",tabindex:"-1"},[s("设置 Pod Template "),i("a",{class:"header-anchor",href:"#设置-pod-template","aria-label":'Permalink to "设置 Pod Template"'},"​")],-1),i("p",null,"Pod Template 就是 slave 节点将会启动的Pod，我们可以设置多个Pod Template 来适配多个流水线的运作，这里我们只新建一个 Pod Template",-1),i("p",null,"进入 系统管理-Clouds-worker1-Pod Templates，点击右上角的 Add a pod template 进入Pod template settings 页面，接下来设置 Pod Template。",-1),i("ul",null,[i("li",null,[i("p",null,[s("名称 "),i("code",null,"jenkins-slave")])]),i("li",null,[i("p",null,[s("命名空间 "),i("code",null,"devops")])]),i("li",null,[i("p",null,[s("标签列表 "),i("code",null,"jenkins-slave-k8s")])])],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164109927.png",alt:"image-20240930102114012",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("卷设置，点击"),i("code",null,"添加卷"),s("，选择 "),i("code",null,"Host Path Volume"),s("，接下来需要填入多个从主机映射到 Pod 中的文件")],-1),i("table",null,[i("thead",null,[i("tr",null,[i("th",null,"Host Path Volume"),i("th",null,"主机路径"),i("th",null,"挂载路径")])]),i("tbody",null,[i("tr",null,[i("td",null,"docker 命令"),i("td",null,"/usr/bin/docker"),i("td",null,"/usr/bin/docker")]),i("tr",null,[i("td",null,"docker 套接字"),i("td",null,"/var/run/docker.sock"),i("td",null,"/var/run/docker.sock")]),i("tr",null,[i("td",null,"kubectl 配置文件"),i("td",null,"/root/.kube"),i("td",null,"/root/.kube")]),i("tr",null,[i("td",null,"kubectl 命令"),i("td",null,"/usr/bin/kubectl"),i("td",null,"/usr/bin/kubectl")]),i("tr",null,[i("td",null,"ctr 命令"),i("td",null,"/usr/bin/ctr"),i("td",null,"/usr/bin/ctr")]),i("tr",null,[i("td",null,"containerd 套接字"),i("td",null,"/run/containerd/containerd.sock"),i("td",null,"/run/containerd/containerd.sock")])])],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164114940.png",alt:"image-20240930102147934",loading:"lazy",decoding:"async"})],-1),i("p",null,[s("然后翻动页面到下方，找到"),i("code",null,"Run As User ID"),s("和"),i("code",null,"Run As Group ID"),s("，填入"),i("code",null,"0"),s("，目的是让 Pod 中的容器可以正常执行 docker 和 ctr 命令。（0 是宿主机 root 用户的组 ID）")],-1),i("p",null,"![image-20240930102156219](/Users/horonlee/Library/Application Support/typora-user-images/image-20240930102156219.png)",-1),i("h4",{id:"设置容器",tabindex:"-1"},[s("设置容器 "),i("a",{class:"header-anchor",href:"#设置容器","aria-label":'Permalink to "设置容器"'},"​")],-1),i("blockquote",null,[i("p",null,"最新 Jenkins 默认如果 pod 名称不设置为 jnlp 的话，会自动启动一个 inbound-agent 镜像来")],-1),i("p",null,[s("在刚才的 Pod template settings 中找到"),i("code",null,"容器列表"),s("选项，点击"),i("code",null,"添加容器"),s("选择 "),i("code",null,"Container Template")],-1),i("ul",null,[i("li",null,[s("名称 "),i("code",null,"nodejs")]),i("li",null,[s("Docker 镜像 "),i("code",null,"172.30.26.172/library/inbound-agent-node:latest")]),i("li",null,[s("运行的命令 "),i("code",null,"sleep")]),i("li",null,[s("命令参数 "),i("code",null,"9999999")]),i("li",null,[s("勾选 "),i("code",null,"分配伪终端")])],-1),i("p",null,"点击下方 Save 完成 Pod Template 的设置",-1),i("h2",{id:"配置并运行流水线",tabindex:"-1"},[s("配置并运行流水线 "),i("a",{class:"header-anchor",href:"#配置并运行流水线","aria-label":'Permalink to "配置并运行流水线"'},"​")],-1),i("p",null,"新建流水线，命名 ValaxyBlog",-1),i("p",null,[s("点击配置，在高级项目选项中配置流水线脚本，其中"),i("code",null,"environment"),s("是环境变量的配置，请将"),i("code",null,"DOCKER_REGISTRY"),s("改为 Harbor 仓库地址，"),i("code",null,"Checkout Code"),s("步骤中的"),i("code",null,"git url"),s("后面的仓库地址请改为自己的 Gitea 项目的 http 地址，")],-1),i("div",{class:"language-json"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"pipeline {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"  agent"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"    label"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'jenkins-slave-k8s'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  environment {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        DOCKER_REGISTRY"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "172.30.26.172"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        IMAGE_NAME"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "library/valaxy"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        IMAGE_TAG"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "dev"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        DOCKER_USERNAME"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'admin'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        DOCKER_PASSWORD"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'Harbor12345'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        DEPLOY_PORT"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ="),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," '30080'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    stages {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        stage('Checkout"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," Code')"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                git"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," url"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"'http:"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//172.30.26.173:3000/root/valaxy.git', branch: 'main'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stage('Build Application') {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                container"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ('nodejs')"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                    script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                        sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'pnpm"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," i'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                        sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'npm"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," run"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," build'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stage('Build Docker Image') {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                    sh"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "docker build -t ${DOCKER_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} ."')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stage('Push Docker Image') {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                echo"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "Docker image will pushed to ${DOCKER_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                sh"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "echo ${DOCKER_PASSWORD} | docker login ${DOCKER_REGISTRY} -u ${DOCKER_USERNAME} --password-stdin"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                sh"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "docker push ${DOCKER_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'docker"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," rmi"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ${DOCKER_REGISTRY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}/${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_NAME"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}:${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_TAG"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} || "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }    ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stage('Deploy to Kubernetes') {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                    sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                    kubectl"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," create"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," deployment"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," valaxy"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," --image=${DOCKER_REGISTRY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}/${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_NAME"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}:${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_TAG"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} --dry-run=client -o yaml >> valaxy-manifests.yaml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    echo "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"---"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," >> valaxy-manifests.yaml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    kubectl create service nodeport valaxy --tcp="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"80"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"80"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," --node-port=${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"DEPLOY_PORT"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} --dry-run=client -o yaml >> valaxy-manifests.yaml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sh "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"                    sed -i '22a "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"        imagePullPolicy: IfNotPresent' valaxy-manifests.yaml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                    """')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sh '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ctr -n k"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"s.io image pull --plain-http ${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"DOCKER_REGISTRY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}/${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_NAME"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}:${"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"IMAGE_TAG"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sh '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    kubectl delete -f valaxy-manifests.yaml || "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    kubectl apply -f valaxy-manifests.yaml")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    '''")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164125780.png",alt:"",loading:"lazy",decoding:"async"})],-1),i("p",null,"点击左侧的立即构建，流水线就开始运行了",-1),i("p",null,"可以进入构建的 Console Output 中看到构建的详细情况",-1),i("p",null,"也可以进入 BlueOcean 更直观的看到构建细节",-1),i("p",null,[s("在构建过程中，我们可以在宿主机上通过"),i("code",null,"kubectl -n devops get po"),s("指令查看临时生成的 jenkins-slave pod，它正在运行 jenkins-master 下发的流水线")],-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916164129933.png",alt:"image-20240930102217151",loading:"lazy",decoding:"async"})],-1),i("p",null,"构建完成后，访问 http://172.30.26.172:30080就可以看到博客正常被测试发布了，临时的 jenkins-slave pod 也被自动删除了",-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916165046164.png",alt:"image-20240930102239242",loading:"lazy",decoding:"async"})],-1),i("p",null,"🎉看到此页面就代表我们已经通过 agent 节点的功能完成了 CICD！",-1),i("h1",{id:"the-end",tabindex:"-1"},[s("The End "),i("a",{class:"header-anchor",href:"#the-end","aria-label":'Permalink to "The End"'},"​")],-1),i("p",null,[s("恭喜你完成了本次练习！相信你一定对 Jenkins 的使用有了更深的理解，当然上文还是倾向于实操步骤，我没有详细说明一些配置项目的作用，以及流水线的各种细节功能，这是因为我也没有完全理解 jenkins 的 pipeline 的编写，如果你还想继续深究，请前往 "),i("a",{href:"https://www.jenkins.io/zh/doc/",target:"_blank",rel:"noreferrer"},"Jenkins 用户手册"),s("进行查阅，一定会有很多的收货！")],-1),i("p",null,"下面是我在撰写这边文章的时候记录的测试步骤，其中包含了设置多个 Container Pod 的相关知识，如果你感兴趣可以继续往下看！",-1),i("p",null,"那么本文理论上就到此为止了，see u～",-1),i("h2",{id:"功能测试",tabindex:"-1"},[s("功能测试 "),i("a",{class:"header-anchor",href:"#功能测试","aria-label":'Permalink to "功能测试"'},"​")],-1),i("h3",{id:"设置-pod-template-1",tabindex:"-1"},[s("设置 Pod template "),i("a",{class:"header-anchor",href:"#设置-pod-template-1","aria-label":'Permalink to "设置 Pod template"'},"​")],-1),i("p",null,[s("进入 worker1 这个 cloud 的配置页面"),i("a",{href:"http://172.30.26.172:32000/manage/cloud/worker1/",target:"_blank",rel:"noreferrer"},"http://172.30.26.172:32000/manage/cloud/worker1/")],-1),i("p",null,[s("点击 "),i("code",null,"Pod templates"),s("-"),i("code",null,"Add a pod template")],-1),i("p",null,[s("名称"),i("code",null,"jenkins-slave")],-1),i("p",null,[s("命名空间"),i("code",null,"devops")],-1),i("p",null,[s("标签列表"),i("code",null,"jenkins-slave-k8s")],-1),i("h4",{id:"容器列表",tabindex:"-1"},[s("容器列表 "),i("a",{class:"header-anchor",href:"#容器列表","aria-label":'Permalink to "容器列表"'},"​")],-1),i("p",null,[s("点击"),i("code",null,"添加容器"),s("-"),i("code",null,"Container Template")],-1),i("p",null,[s("名称"),i("code",null,"jnlp")],-1),i("p",null,[s("Docker 镜像"),i("code",null,"docker.io/jenkins/inbound-agent:latest")],-1),i("p",null,[s("运行的命令"),i("code",null,"jenkins-agent")],-1),i("p",null,[s("命令参数删除自带的 "),i("code",null,"9999999")],-1),i("p",null,[s("☑️"),i("code",null,"分配伪终端")],-1),i("p",null,"点击最下方 Create 完成 pod template 的创建",-1),i("figure",null,[i("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/K8sJenkinsSlaveCICD/IMG-20250916165009205.png",alt:"image-20240930102129737",loading:"lazy",decoding:"async"})],-1),i("h3",{id:"测试jenkins-slave",tabindex:"-1"},[s("测试jenkins-slave "),i("a",{class:"header-anchor",href:"#测试jenkins-slave","aria-label":'Permalink to "测试jenkins-slave"'},"​")],-1),i("p",null,[s("新建一个名为 "),i("code",null,"jnlp-test"),s("的流水线")],-1),i("p",null,"填写流水线脚本",-1),i("div",{class:"language-json"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"pipeline {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"  agent"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"    label"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'jenkins-slave-k8s'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  stages {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"    stage('test')"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"                println"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "Thie pipeline is run in jenkins-slave."')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("保存，运行流水线，点击"),i("code",null,"立即构建")],-1),i("p",null,[s("查看"),i("code",null,"Console Output")],-1),i("div",{class:"language-json"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Started by user jenkins")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] Start of Pipeline")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] node")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Agent jenkins-slave-fxpzg is provisioned from template jenkins-slave")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"---")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"apiVersion: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"v1"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"......省略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    name: "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"workspace-volume"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Running on jenkins-slave-fxpzg in /home/jenkins/agent/workspace/jnlp-test")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," stage")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," (test)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," script")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," echo")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Thie"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," pipeline"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," is"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," run"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," in"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," jenkins-slave.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"[Pipeline]"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// script")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// stage")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// node")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"Pipeline"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] End of Pipeline")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Finished: SUCCESS")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("出现"),i("code",null,"Thie pipeline is run in jenkins-slave."),s("就代表使用 jenkins-slave 构建成功了！")],-1),i("p",null,[s("在构建的过程中通过"),i("code",null,"kubectl -n devops get po"),s("可以查看到有一个名为"),i("code",null,"jenkins-slave-5jjcw"),s("的 pod 在 running 状态，当流水线运行完成后，这个 pod 又会马上消失，这代表我们确实完成了动态的 jenkins-slave 的功能实现。")],-1),i("h3",{id:"设置多个-pod-template",tabindex:"-1"},[s("设置多个 Pod Template "),i("a",{class:"header-anchor",href:"#设置多个-pod-template","aria-label":'Permalink to "设置多个 Pod Template"'},"​")],-1),i("p",null,"进入 clouds>worker1>jenkins-slave 页面",-1),i("p",null,[s("点击"),i("code",null,"添加容器"),s("-"),i("code",null,"Container Template")],-1),i("p",null,[s("名称"),i("code",null,"nodejs")],-1),i("p",null,[s("Docker 镜像"),i("code",null,"172.30.26.172/library/inbound-agent-node:latest")],-1),i("p",null,[s("运行的命令"),i("code",null,"sleep")],-1),i("p",null,[s("命令参数保持 "),i("code",null,"9999999")],-1),i("h4",{id:"自定义一个-agent-镜像",tabindex:"-1"},[s("自定义一个 agent 镜像 "),i("a",{class:"header-anchor",href:"#自定义一个-agent-镜像","aria-label":'Permalink to "自定义一个 agent 镜像"'},"​")],-1),i("blockquote",null,[i("p",null,"因为项目是基于 vite 的项目，所以构建需要 node 环境")],-1),i("p",null,"创建inbound-agent-node目录，在此目录完成镜像构建",-1),i("p",null,[s("下载 nodejs 程序 "),i("code",null,"wget https://nodejs.org/dist/v20.13.1/node-v20.13.1-linux-x64.tar.xz")],-1),i("p",null,"编辑 Dockerfile",-1),i("p",null,[i("code",null,"vim inbound-agent-node-Dockerfile")],-1),i("div",{class:"language-dockerfile"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"dockerfile"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"FROM"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," jenkins/inbound-agent")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"USER"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," root")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WORKDIR"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," /usr/local")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ADD"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node-v20.13.1-linux-x64.tar.xz .")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ENV"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PATH="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/usr/local/node-v20.13.1-linux-x64/bin:${PATH}"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RUN"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," npm config set registry https://registry.npmmirror.com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RUN"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," npm install -g pnpm")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ENTRYPOINT"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jenkins-agent"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("构建镜像 "),i("code",null,"docker build -t 172.30.26.172/library/inbound-agent-node:latest . -f inbound-agent-node-Dockerfile")],-1),i("p",null,[s("推送到 Harbor "),i("code",null,"docker push 172.30.26.172/library/inbound-agent-node:latest")],-1),i("h4",{id:"编写流水线",tabindex:"-1"},[s("编写流水线 "),i("a",{class:"header-anchor",href:"#编写流水线","aria-label":'Permalink to "编写流水线"'},"​")],-1),i("blockquote",null,[i("p",null,[s("根据最新的 kubernetes 插件的规则进行编写，官方页面写了两种方法，这里使用第三种方法，不用手动写 Pod Template——"),i("a",{href:"https://plugins.jenkins.io/kubernetes/",target:"_blank",rel:"noreferrer"},"Kubernetes 的 |Jenkins 插件")])],-1),i("div",{class:"language-json"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"pipeline {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"  agent"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"    label"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'jenkins-slave-k8s'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  stages {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"    stage('test')"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"      steps"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"        container"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ('jnlp')"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"          script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            println"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "This pipeline is run in jnlp pod."')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'node"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," -v"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," ||"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," true'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        container ('nodejs') {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"          script"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            println"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},' "This pipeline is run in node pod."')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'node"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," -v'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'npm"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," -v'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"            sh"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," 'pnpm"),i("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}}," -v'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("p",null,[s("运行流水线，在 Console Output 中可以看到自动生成的 yaml 文件中有了两个 Containers，证明了"),i("code",null,"test stage"),s("中的第唯一一个"),i("code",null,"steps"),s("中确实启动了两个容器，通过 kubectl 命令可以看到有一个 pod 在运行，说面多 pod template 模式功能测试成功。")],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Started"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," by"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," user"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] Start of Pipeline")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] node")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Agent"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins-slave-1g78h"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," is"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," provisioned"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," template"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins-slave")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apiVersion:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "v1"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"....."),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".yaml"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 省略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Running"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," on"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins-slave-1g78h"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /home/jenkins/agent/workspace/jnlp-test")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},".."),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".省略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] echo")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"This"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pipeline"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," is"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jnlp"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pod.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] sh")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," node"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"/home/jenkins/agent/workspace/jnlp-test@tmp/durable-8ed80d21/script.sh.copy:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 1:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," node:"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," not"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," found")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"+"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},".."),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".省略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] echo")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"This"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pipeline"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," is"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," node"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pod.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] sh")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," node"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"v20.13.1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] sh")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," npm"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"10.5.2")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[Pipeline] sh")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"+"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pnpm"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -v")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"9.1.2")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},".."),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},".省略")])])]),i("button",{class:"code-block-unfold-btn"})],-1),i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@master "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"~"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]# kubectl -n devops get po")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"NAME"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"                       READY"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"   STATUS"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    RESTARTS"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"      AGE")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"jenkins-79f4445887-lncxs"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"   1/1"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"     Running"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (45h "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ago"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")   46h")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"jenkins-slave-2zwxb"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"        2/2"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"     Running"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"   0"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"             41s")])])]),i("button",{class:"code-block-unfold-btn"})],-1)])]),"main-header":l(()=>[a(n.$slots,"main-header")]),"main-header-after":l(()=>[a(n.$slots,"main-header-after")]),"main-nav":l(()=>[a(n.$slots,"main-nav")]),"main-content-before":l(()=>[a(n.$slots,"main-content-before")]),"main-content":l(()=>[a(n.$slots,"main-content")]),"main-content-after":l(()=>[a(n.$slots,"main-content-after")]),"main-nav-before":l(()=>[a(n.$slots,"main-nav-before")]),"main-nav-after":l(()=>[a(n.$slots,"main-nav-after")]),comment:l(()=>[a(n.$slots,"comment")]),footer:l(()=>[a(n.$slots,"footer")]),aside:l(()=>[a(n.$slots,"aside")]),"aside-custom":l(()=>[a(n.$slots,"aside-custom")]),default:l(()=>[a(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{M as default,f as usePageData};
