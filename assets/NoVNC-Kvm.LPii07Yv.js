import{_ as u}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CVz-OEk3.js";import"./chunks/@vueuse/motion.Bjv2JULu.js";import{e as h,u as b,a as v}from"./chunks/vue-router.CkK6wkE3.js";import{aa as f,al as n,ad as t,ae as e,ai as a,F as k,ab as g,Z as N}from"./framework.DiIp3j3P.js";import"./app.DYfWnlAw.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.Cqw7qwJJ.js";import"./chunks/pinia.DAg2g0nX.js";import"./chunks/nprogress.QNtX8Req.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.YMmXRdII.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.NFwy7W3t.js";import"./post.DSQTc9o3.js";const y=h("/posts/NoVNC-Kvm",async s=>JSON.parse('{"title":"配置NoVNC连接Kvm虚拟机","description":"","frontmatter":{"layout":"post","title":"配置NoVNC连接Kvm虚拟机","date":"2025-04-13 20:19:35","tags":["Linux","NoVNC","KVM"],"categories":["Linux","KVM"],"cover":"https://minio-api.horonlee.com/obsidian/assets/博文/配置NoVNC连接Kvm虚拟机/IMG-20250918223958116.png","password":null,"hide":null},"headers":[],"relativePath":"pages/posts/NoVNC-Kvm.md","lastUpdated":1758206429000}'),{lazy:(s,l)=>s.name===l.name}),L={__name:"NoVNC-Kvm",setup(s,{expose:l}){const{data:r}=y(),p=v(),m=b(),i=Object.assign(m.meta.frontmatter||{},r.value?.frontmatter||{});return p.currentRoute.value.data=r.value,N("valaxy:frontmatter",i),globalThis.$frontmatter=i,l({frontmatter:{layout:"post",title:"配置NoVNC连接Kvm虚拟机",date:"2025-04-13 20:19:35",tags:["Linux","NoVNC","KVM"],categories:["Linux","KVM"],cover:"https://minio-api.horonlee.com/obsidian/assets/博文/配置NoVNC连接Kvm虚拟机/IMG-20250918223958116.png",password:null,hide:null}}),(o,c)=>{const d=u;return g(),f(d,{frontmatter:k(i)},{"main-content-md":n(()=>[...c[0]||(c[0]=[e("h2",{id:"虚拟机显示器输出设置",tabindex:"-1"},[a("虚拟机显示器输出设置 "),e("a",{class:"header-anchor",href:"#虚拟机显示器输出设置","aria-label":'Permalink to "虚拟机显示器输出设置"'},"​")],-1),e("p",null,"通过virsh或者virt-manager查看虚拟机的显示定义，其中类型需要是vnc；端口最好是autoport，这样会自动生成可用的端口，一般从5900自增；监听IP最好为0.0.0.0也就是监听所有接口，下面会说明如何设置默认监听IP",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,'<graphics type="vnc" port="5900" autoport="yes" listen="0.0.0.0">')]),a(`
`),e("span",{class:"line"},[e("span",null,'  <listen type="address" address="0.0.0.0"/>')]),a(`
`),e("span",{class:"line"},[e("span",null,"</graphics>")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"需要用的软件",tabindex:"-1"},[a("需要用的软件 "),e("a",{class:"header-anchor",href:"#需要用的软件","aria-label":'Permalink to "需要用的软件"'},"​")],-1),e("blockquote",null,[e("p",null,[e("a",{href:"https://github.com/novnc/noVNC",target:"_blank",rel:"noreferrer"},"novnc/noVNC: VNC client web application")]),e("p",null,[e("a",{href:"https://github.com/novnc/websockify",target:"_blank",rel:"noreferrer"},"novnc/websockify: Websockify is a WebSocket to TCP proxy/bridge. This allows a browser to connect to any application/server/service.")])],-1),e("h2",{id:"更改vnc监听默认设置",tabindex:"-1"},[a("更改vnc监听默认设置 "),e("a",{class:"header-anchor",href:"#更改vnc监听默认设置","aria-label":'Permalink to "更改vnc监听默认设置"'},"​")],-1),e("p",null,[a("打开配置文件"),e("code",null,"sudo vim /etc/libvirt/qemu.conf"),a("，取消注释"),e("code",null,'#vnc_listen = "0.0.0.0"')],-1),e("h2",{id:"获得客户机的显示器编号",tabindex:"-1"},[a("获得客户机的显示器编号 "),e("a",{class:"header-anchor",href:"#获得客户机的显示器编号","aria-label":'Permalink to "获得客户机的显示器编号"'},"​")],-1),e("p",null,"由此可见默认是显示器0，不过这和下文没有任何关系，仅作演示",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"➜  ~ sudo virsh vncdisplay rocky9")]),a(`
`),e("span",{class:"line"},[e("span",null,":0")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"启动novnc",tabindex:"-1"},[a("启动NoVNC "),e("a",{class:"header-anchor",href:"#启动novnc","aria-label":'Permalink to "启动NoVNC"'},"​")],-1),e("p",null,[e("code",null,"➜ noVNC git:master sudo ./utils/novnc_proxy --vnc 127.0.0.1:5900")],-1),e("h2",{id:"单端口多代理",tabindex:"-1"},[a("单端口多代理 "),e("a",{class:"header-anchor",href:"#单端口多代理","aria-label":'Permalink to "单端口多代理"'},"​")],-1),e("p",null,[a("novnc实际上会自动启动一个websockify实例，novnc只是一个前端，实现vnc信号从tcp转化为websocket协议的是websockify这个软件，我们现在只需要一个websockify实例就可以单端口多代理。需要使用独立的websockify，官方wiki："),e("a",{href:"https://github.com/novnc/websockify/wiki/Token-based-target-selection",target:"_blank",rel:"noreferrer"},"novnc/websockify 维基")],-1),e("p",null,[a("设置token文件，格式为"),e("code",null,"[token名]: [vnc的IP]:[vnc的端口]"),a("，一行一个虚拟机")],-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"➜  websockify git:master ✗ cat token/kvm.conf")]),a(`
`),e("span",{class:"line"},[e("span",null,"rocky9: 127.0.0.1:5900")]),a(`
`),e("span",{class:"line"},[e("span",null,"rocky9-clone: 127.0.0.1:5901")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("p",null,[a("启动websockify的时候带上token文件位置参数"),e("code",null,"sudo ./run --token-plugin TokenFile --token-source ./token/kvm.conf 6080")],-1),e("p",null,"此时6080被占用，所以我们需要再为novnc的网页前端配置http服务，此步骤略",-1),e("p",null,[a("原本的NoVNC网址是"),e("code",null,"http://192.168.6.166:6081/?host=192.168.6.166&port=6080&path=websockify")],-1),e("p",null,[a("为了按照token选择不同的vncserver，我们需要在后方加上路由参数"),e("code",null,"/?token=rocky9"),a(" 所以最终是 "),e("code",null,"http://192.168.6.166:6081/?host=192.168.6.166&port=6080&path=websockify/?token=rocky9")],-1),e("h2",{id:"最终效果",tabindex:"-1"},[a("最终效果 "),e("a",{class:"header-anchor",href:"#最终效果","aria-label":'Permalink to "最终效果"'},"​")],-1),e("p",null,[e("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/%E9%85%8D%E7%BD%AENoVNC%E8%BF%9E%E6%8E%A5Kvm%E8%99%9A%E6%8B%9F%E6%9C%BA/IMG-20250916163419195.png",alt:"Pasted image 20250413195710.png"}),e("img",{src:"https://minio-api.horonlee.com/obsidian/assets/%E5%8D%9A%E6%96%87/%E9%85%8D%E7%BD%AENoVNC%E8%BF%9E%E6%8E%A5Kvm%E8%99%9A%E6%8B%9F%E6%9C%BA/IMG-20250916163423756.png",alt:"Pasted image 20250413195605.png"}),a(" 很好，我们已经实现了通过不同的路由参数，通过NoVNC访问不同的虚拟机！")],-1)])]),"main-header":n(()=>[t(o.$slots,"main-header")]),"main-header-after":n(()=>[t(o.$slots,"main-header-after")]),"main-nav":n(()=>[t(o.$slots,"main-nav")]),"main-content-before":n(()=>[t(o.$slots,"main-content-before")]),"main-content":n(()=>[t(o.$slots,"main-content")]),"main-content-after":n(()=>[t(o.$slots,"main-content-after")]),"main-nav-before":n(()=>[t(o.$slots,"main-nav-before")]),"main-nav-after":n(()=>[t(o.$slots,"main-nav-after")]),comment:n(()=>[t(o.$slots,"comment")]),footer:n(()=>[t(o.$slots,"footer")]),aside:n(()=>[t(o.$slots,"aside")]),"aside-custom":n(()=>[t(o.$slots,"aside-custom")]),default:n(()=>[t(o.$slots,"default")]),_:3},8,["frontmatter"])}}};export{L as default,y as usePageData};
