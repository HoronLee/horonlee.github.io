import{_ as u}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BKY0BFev.js";import"./chunks/@vueuse/motion.C1YF0VrX.js";import{d as h,u as b,a as f}from"./chunks/vue-router.B0lpXBWQ.js";import{X as v,b3 as k,b_ as n,be as o,_ as e,a5 as a,bB as g,b5 as N}from"./framework.tSB2Odh-.js";import"./app.CfWrNu88.js";import"./chunks/dayjs.BmWuu2Zz.js";import"./chunks/vue-i18n.CP2UHYEb.js";import"./chunks/pinia.BF0-M7Fk.js";import"./chunks/nprogress.YXB5kar1.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.DoC94HOc.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CBF25nPr.js";import"./post.TKccRjPH.js";const y="/attachment/%E9%85%8D%E7%BD%AENoVNC%E8%BF%9E%E6%8E%A5Kvm%E8%99%9A%E6%8B%9F%E6%9C%BA/d7d4cce1369f648caab5106cc1e9a7b9.png",C="/attachment/%E9%85%8D%E7%BD%AENoVNC%E8%BF%9E%E6%8E%A5Kvm%E8%99%9A%E6%8B%9F%E6%9C%BA/0ee3ea21dfd6d72ca524b15ebe53e84a.png",V=h("/posts/配置NoVNC连接Kvm虚拟机",async s=>JSON.parse('{"title":"配置NoVNC连接Kvm虚拟机","description":"","frontmatter":{"title":"配置NoVNC连接Kvm虚拟机","date":"2025-09-19 14:31:04","tags":["NoVNC"],"categories":["Linux","KVM"],"cover":"/attachment/配置NoVNC连接Kvm虚拟机/2230097ef916372114bf21e33063a3e2.png","dg-publish":true},"headers":[],"relativePath":"pages/posts/配置NoVNC连接Kvm虚拟机.md","lastUpdated":1767692976000}'),{lazy:(s,l)=>s.name===l.name}),R={__name:"配置NoVNC连接Kvm虚拟机",setup(s,{expose:l}){const{data:i}=V(),p=b(),m=f(),r=Object.assign(m.meta.frontmatter||{},i.value?.frontmatter||{});return p.currentRoute.value.data=i.value,N("valaxy:frontmatter",r),globalThis.$frontmatter=r,l({frontmatter:{title:"配置NoVNC连接Kvm虚拟机",date:"2025-09-19 14:31:04",tags:["NoVNC"],categories:["Linux","KVM"],cover:"/attachment/配置NoVNC连接Kvm虚拟机/2230097ef916372114bf21e33063a3e2.png","dg-publish":!0}}),(t,c)=>{const d=u;return k(),v(d,{frontmatter:g(r)},{"main-content-md":n(()=>[...c[0]||(c[0]=[e("h2",{id:"虚拟机显示器输出设置",tabindex:"-1"},[a("虚拟机显示器输出设置 "),e("a",{class:"header-anchor",href:"#虚拟机显示器输出设置","aria-label":'Permalink to "虚拟机显示器输出设置"'},"​")],-1),e("p",null,"通过virsh或者virt-manager查看虚拟机的显示定义，其中类型需要是vnc；端口最好是autoport，这样会自动生成可用的端口，一般从5900自增；监听IP最好为0.0.0.0也就是监听所有接口，下面会说明如何设置默认监听IP",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,'<graphics type="vnc" port="5900" autoport="yes" listen="0.0.0.0">')]),a(`
`),e("span",{class:"line"},[e("span",null,'  <listen type="address" address="0.0.0.0"/>')]),a(`
`),e("span",{class:"line"},[e("span",null,"</graphics>")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"需要用的软件",tabindex:"-1"},[a("需要用的软件 "),e("a",{class:"header-anchor",href:"#需要用的软件","aria-label":'Permalink to "需要用的软件"'},"​")],-1),e("blockquote",null,[e("p",null,[e("a",{href:"https://github.com/novnc/noVNC",target:"_blank",rel:"noreferrer"},"novnc/noVNC: VNC client web application")]),e("p",null,[e("a",{href:"https://github.com/novnc/websockify",target:"_blank",rel:"noreferrer"},"novnc/websockify: Websockify is a WebSocket to TCP proxy/bridge. This allows a browser to connect to any application/server/service.")])],-1),e("h2",{id:"更改vnc监听默认设置",tabindex:"-1"},[a("更改vnc监听默认设置 "),e("a",{class:"header-anchor",href:"#更改vnc监听默认设置","aria-label":'Permalink to "更改vnc监听默认设置"'},"​")],-1),e("p",null,[a("打开配置文件"),e("code",null,"sudo vim /etc/libvirt/qemu.conf"),a("，取消注释"),e("code",null,'#vnc_listen = "0.0.0.0"')],-1),e("h2",{id:"获得客户机的显示器编号",tabindex:"-1"},[a("获得客户机的显示器编号 "),e("a",{class:"header-anchor",href:"#获得客户机的显示器编号","aria-label":'Permalink to "获得客户机的显示器编号"'},"​")],-1),e("p",null,"由此可见默认是显示器0，不过这和下文没有任何关系，仅作演示",-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"➜  ~ sudo virsh vncdisplay rocky9")]),a(`
`),e("span",{class:"line"},[e("span",null,":0")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("h2",{id:"启动novnc",tabindex:"-1"},[a("启动NoVNC "),e("a",{class:"header-anchor",href:"#启动novnc","aria-label":'Permalink to "启动NoVNC"'},"​")],-1),e("p",null,[e("code",null,"➜ noVNC git:master sudo ./utils/novnc_proxy --vnc 127.0.0.1:5900")],-1),e("h2",{id:"单端口多代理",tabindex:"-1"},[a("单端口多代理 "),e("a",{class:"header-anchor",href:"#单端口多代理","aria-label":'Permalink to "单端口多代理"'},"​")],-1),e("p",null,[a("novnc实际上会自动启动一个websockify实例，novnc只是一个前端，实现vnc信号从tcp转化为websocket协议的是websockify这个软件，我们现在只需要一个websockify实例就可以单端口多代理。需要使用独立的websockify，官方wiki："),e("a",{href:"https://github.com/novnc/websockify/wiki/Token-based-target-selection",target:"_blank",rel:"noreferrer"},"novnc/websockify 维基")],-1),e("p",null,[a("设置token文件，格式为"),e("code",null,"[token名]: [vnc的IP]:[vnc的端口]"),a("，一行一个虚拟机")],-1),e("div",{class:"language-"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"➜  websockify git:master ✗ cat token/kvm.conf")]),a(`
`),e("span",{class:"line"},[e("span",null,"rocky9: 127.0.0.1:5900")]),a(`
`),e("span",{class:"line"},[e("span",null,"rocky9-clone: 127.0.0.1:5901")])])]),e("button",{class:"code-block-unfold-btn"})],-1),e("p",null,[a("启动websockify的时候带上token文件位置参数"),e("code",null,"sudo ./run --token-plugin TokenFile --token-source ./token/kvm.conf 6080")],-1),e("p",null,"此时6080被占用，所以我们需要再为novnc的网页前端配置http服务，此步骤略",-1),e("p",null,[a("原本的NoVNC网址是"),e("code",null,"http://192.168.6.166:6081/?host=192.168.6.166&port=6080&path=websockify")],-1),e("p",null,[a("为了按照token选择不同的vncserver，我们需要在后方加上路由参数"),e("code",null,"/?token=rocky9"),a(" 所以最终是 "),e("code",null,"http://192.168.6.166:6081/?host=192.168.6.166&port=6080&path=websockify/?token=rocky9")],-1),e("h2",{id:"最终效果",tabindex:"-1"},[a("最终效果 "),e("a",{class:"header-anchor",href:"#最终效果","aria-label":'Permalink to "最终效果"'},"​")],-1),e("p",null,[e("img",{src:y,alt:""}),e("img",{src:C,alt:""})],-1),e("p",null,"很好，我们已经实现了通过不同的路由参数，通过NoVNC访问不同的虚拟机！",-1)])]),"main-header":n(()=>[o(t.$slots,"main-header")]),"main-header-after":n(()=>[o(t.$slots,"main-header-after")]),"main-nav":n(()=>[o(t.$slots,"main-nav")]),"main-content-before":n(()=>[o(t.$slots,"main-content-before")]),"main-content":n(()=>[o(t.$slots,"main-content")]),"main-content-after":n(()=>[o(t.$slots,"main-content-after")]),"main-nav-before":n(()=>[o(t.$slots,"main-nav-before")]),"main-nav-after":n(()=>[o(t.$slots,"main-nav-after")]),comment:n(()=>[o(t.$slots,"comment")]),footer:n(()=>[o(t.$slots,"footer")]),aside:n(()=>[o(t.$slots,"aside")]),"aside-custom":n(()=>[o(t.$slots,"aside-custom")]),default:n(()=>[o(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{R as default,V as usePageData};
