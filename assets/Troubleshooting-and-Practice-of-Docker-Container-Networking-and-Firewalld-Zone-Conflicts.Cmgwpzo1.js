const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mermaid.core.C4dMzzns.js","assets/framework.tSB2Odh-.js","assets/chunks/dayjs.BmWuu2Zz.js"])))=>i.map(i=>d[i]);
import{_ as z}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BKY0BFev.js";import{a9 as x,bb as c,U as I,bW as f,Z as P,b3 as b,c5 as N,al as O,bV as Z,X as D,b_ as u,be as h,_ as l,a6 as S,a5 as s,aM as T,bB as L,b5 as $}from"./framework.tSB2Odh-.js";import"./chunks/@vueuse/motion.C1YF0VrX.js";import{U as R,R as W,V as q}from"./app.CfWrNu88.js";import"./chunks/dayjs.BmWuu2Zz.js";import{d as M,u as U,a as V}from"./chunks/vue-router.B0lpXBWQ.js";import"./YunComment.vue_vue_type_style_index_0_lang.DoC94HOc.js";import"./index.C5okkQwF.js";import"./chunks/vue-i18n.CP2UHYEb.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CBF25nPr.js";import"./post.TKccRjPH.js";import"./chunks/pinia.BF0-M7Fk.js";import"./chunks/nprogress.YXB5kar1.js";/* empty css                    */function y(e){return Object.keys(e).forEach(i=>e[i]===void 0?delete e[i]:{}),e}const C=typeof Buffer=="function",B=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",H=Array.prototype.slice.call(j),F=(e=>{let i={};return e.forEach((r,d)=>i[r]=d),i})(H),X=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,g=String.fromCharCode.bind(String),v=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),E=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),J=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,K=e=>{switch(e.length){case 4:var i=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=i-65536;return g((r>>>10)+55296)+g((r&1023)+56320);case 3:return g((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return g((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Y=e=>e.replace(J,K),Q=e=>{if(e=e.replace(/\s+/g,""),!X.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let i,r,d,a=[];for(let o=0;o<e.length;)i=F[e.charAt(o++)]<<18|F[e.charAt(o++)]<<12|(r=F[e.charAt(o++)])<<6|(d=F[e.charAt(o++)]),r===64?a.push(g(i>>16&255)):d===64?a.push(g(i>>16&255,i>>8&255)):a.push(g(i>>16&255,i>>8&255,i&255));return a.join("")},A=typeof atob=="function"?e=>atob(E(e)):C?e=>Buffer.from(e,"base64").toString("binary"):Q,G=C?e=>v(Buffer.from(e,"base64")):e=>v(A(e).split("").map(i=>i.charCodeAt(0))),_=C?e=>Buffer.from(e,"base64").toString("utf8"):B?e=>B.decode(G(e)):e=>Y(A(e)),ll=e=>E(e.replace(/[-_]/g,i=>i=="-"?"+":"/")),tl=e=>_(ll(e));let el=e=>crypto.getRandomValues(new Uint8Array(e)),sl=(e,i,r)=>{let d=(2<<Math.log2(e.length-1))-1,a=-~(1.6*d*i/e.length);return(o=i)=>{let k="";for(;;){let n=r(a),t=a|0;for(;t--;)if(k+=e[n[t]&d]||"",k.length>=o)return k}}},il=(e,i=21)=>sl(e,i|0,el);const nl=R(()=>({theme:"default"})),al=il("abcedfghicklmn",10),w=new Map;async function rl(e,i,r){const d=i+JSON.stringify(r),a=w.get(d);if(a)return a;e.initialize({startOnLoad:!1,...y(nl()||{}),...y(r)});const o=tl(i),k=al(),{svg:n}=await e.render(k,o);return w.set(d,n),n}const ol=x({__name:"ShadowRoot",props:{innerHtml:{}},emits:["shadow"],setup(e,{emit:i}){const r=e,d=i,a=c(),o=I(()=>a.value?a.value.shadowRoot||a.value.attachShadow({mode:"open"}):null);return f(()=>{o.value&&r.innerHtml&&(d("shadow",o.value),o.value.innerHTML=r.innerHtml)}),(k,n)=>(b(),P("div",{ref_key:"el",ref:a},null,512))}}),dl=x({__name:"ValaxyMermaid",props:{code:{},scale:{},theme:{}},setup(e){const i=e,r=O(),d=c(),a=c(""),o=W();return q&&N(()=>import("./mermaid.core.C4dMzzns.js").then(k=>k.bB),__vite__mapDeps([0,1,2])).then(k=>k.default).then(k=>{k.startOnLoad=!1,k.initialize({startOnLoad:!1}),f(async t=>{let p=!1;t(()=>{p=!0});const m=await rl(k,i.code||"",{theme:i.theme||(o.isDark?"dark":void 0),...r.attrs});p||(a.value=m)});const n=c();Z(a,()=>{n.value=void 0}),f(()=>{const t=d.value?.children?.[0];if(t&&t.hasAttribute("viewBox")&&n.value==null){const p=Number.parseFloat(t.getAttribute("viewBox")?.split(" ")[3]||"");n.value=Number.isNaN(p)?void 0:p}},{flush:"post"}),f(()=>{const t=d.value?.children?.[0];t!=null&&i.scale!=null&&n.value!=null&&(t.setAttribute("height",`${n.value*i.scale}`),t.removeAttribute("width"),t.removeAttribute("style"))},{flush:"post"})}),(k,n)=>(b(),D(ol,{class:"mermaid","inner-html":a.value,onShadow:n[0]||(n[0]=t=>d.value=t)},null,8,["inner-html"]))}}),kl=M("/posts/Troubleshooting-and-Practice-of-Docker-Container-Networking-and-Firewalld-Zone-Conflicts",async e=>JSON.parse('{"title":"解决Docker容器互联与Firewalld区域冲突的排查与实践","description":"","frontmatter":{"title":"解决Docker容器互联与Firewalld区域冲突的排查与实践","date":"2025-09-19 13:50:01","tags":["Docker","Firewall"],"categories":["Docker"],"cover":"/attachment/Troubleshooting-and-Practice-of-Docker-Container-Networking-and-Firewalld-Zone-Conflicts/de06efc23652c53ff5352ed2c523d57f.png","dg-publish":true},"headers":[],"relativePath":"pages/posts/Troubleshooting-and-Practice-of-Docker-Container-Networking-and-Firewalld-Zone-Conflicts.md","lastUpdated":1767692976000}'),{lazy:(e,i)=>e.name===i.name}),xl={__name:"Troubleshooting-and-Practice-of-Docker-Container-Networking-and-Firewalld-Zone-Conflicts",setup(e,{expose:i}){const{data:r}=kl(),d=U(),a=V(),o=Object.assign(a.meta.frontmatter||{},r.value?.frontmatter||{});return d.currentRoute.value.data=r.value,$("valaxy:frontmatter",o),globalThis.$frontmatter=o,i({frontmatter:{title:"解决Docker容器互联与Firewalld区域冲突的排查与实践",date:"2025-09-19 13:50:01",tags:["Docker","Firewall"],categories:["Docker"],cover:"/attachment/Troubleshooting-and-Practice-of-Docker-Container-Networking-and-Firewalld-Zone-Conflicts/de06efc23652c53ff5352ed2c523d57f.png","dg-publish":!0}}),(n,t)=>{const p=dl,m=z;return b(),D(m,{frontmatter:L(o)},{"main-content-md":u(()=>[t[0]||(t[0]=l("p",null,[s("在 Fedora 42 及更高版本，系统默认使用 "),l("strong",null,"nftables"),s(" 作为防火墙后端，"),l("strong",null,"firewalld"),s(" 用于区域管理。Docker 部署后，容器间网络通信依赖于主机的防火墙规则。最近一次实战中，容器间网络通信出现了完全阻断，经历了多轮排查和配置，最终定位到 firewalld 区域和 Docker 的管理冲突。本文将完整记录排查和解决过程，并附上每一步关键命令及解释。")],-1)),t[1]||(t[1]=l("hr",null,null,-1)),t[2]||(t[2]=l("h2",{id:"_1-问题发现-容器无法互连",tabindex:"-1"},[s("1. 问题发现：容器无法互连 "),l("a",{class:"header-anchor",href:"#_1-问题发现-容器无法互连","aria-label":'Permalink to "1. 问题发现：容器无法互连"'},"​")],-1)),t[3]||(t[3]=l("p",null,[s("首先，发现在 Docker 自定义网络 "),l("code",null,"1panel-network"),s(" 下，不同容器（如 Redis、Cloudreve 等）无法互相 ping 通：")],-1)),t[4]||(t[4]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"docker"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," run"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --rm"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -it"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --network=1panel-network"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," busybox"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," sh")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ping"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 1Panel-redis-XuzC")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[5]||(t[5]=l("blockquote",null,[l("p",null,"结果：100% packet loss")],-1)),t[6]||(t[6]=l("hr",null,null,-1)),t[7]||(t[7]=l("h2",{id:"_2-查看网络与区域归属",tabindex:"-1"},[s("2. 查看网络与区域归属 "),l("a",{class:"header-anchor",href:"#_2-查看网络与区域归属","aria-label":'Permalink to "2. 查看网络与区域归属"'},"​")],-1)),t[8]||(t[8]=l("p",null,"确认所有容器都已正确加入 Docker 网络：",-1)),t[9]||(t[9]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"docker"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," network"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," inspect"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 1panel-network")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[10]||(t[10]=l("blockquote",null,[l("p",null,"用途：查看网络内的所有容器及分配的 IP。")],-1)),t[11]||(t[11]=l("p",null,"查看主机所有接口的防火墙区域归属：",-1)),t[12]||(t[12]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --get-active-zones")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[13]||(t[13]=l("blockquote",null,[l("p",null,"用途：显示每个网络接口归属于哪个 firewalld 区域。")],-1)),t[14]||(t[14]=l("hr",null,null,-1)),t[15]||(t[15]=l("h2",{id:"_3-初步尝试-修改区域规则",tabindex:"-1"},[s("3. 初步尝试：修改区域规则 "),l("a",{class:"header-anchor",href:"#_3-初步尝试-修改区域规则","aria-label":'Permalink to "3. 初步尝试：修改区域规则"'},"​")],-1)),t[16]||(t[16]=l("p",null,[s("尝试将 Docker 网桥接口（如 "),l("code",null,"docker0"),s("）加入全放行的 trusted 区域：")],-1)),t[17]||(t[17]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --zone=trusted"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --add-interface=docker0"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --permanent")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --reload")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[18]||(t[18]=l("blockquote",null,[l("p",null,"用途：让 docker0 网桥流量不受防火墙限制。")],-1)),t[19]||(t[19]=l("hr",null,null,-1)),t[20]||(t[20]=l("h2",{id:"_4-新问题-docker-无法启动",tabindex:"-1"},[s("4. 新问题：Docker 无法启动 "),l("a",{class:"header-anchor",href:"#_4-新问题-docker-无法启动","aria-label":'Permalink to "4. 新问题：Docker 无法启动"'},"​")],-1)),t[21]||(t[21]=l("p",null,"重启 Docker 服务时遇到启动失败：",-1)),t[22]||(t[22]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," systemctl"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," systemctl"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," status"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," journalctl"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -xeu"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker.service"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tail"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -n"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 50")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[23]||(t[23]=l("blockquote",null,[l("p",null,"用途：查看 Docker 服务状态和详细启动日志。")],-1)),t[24]||(t[24]=l("p",null,"日志报错：",-1)),t[25]||(t[25]=l("div",{class:"language-"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",null,`Error initializing network controller: error creating default "bridge" network: ZONE_CONFLICT: 'docker0' already bound to 'trusted'`)])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[26]||(t[26]=l("blockquote",null,[l("p",null,"说明：手动分配区域导致 Docker 自动管理冲突。")],-1)),t[27]||(t[27]=l("hr",null,null,-1)),t[28]||(t[28]=l("h2",{id:"_5-恢复区域归属",tabindex:"-1"},[s("5. 恢复区域归属 "),l("a",{class:"header-anchor",href:"#_5-恢复区域归属","aria-label":'Permalink to "5. 恢复区域归属"'},"​")],-1)),t[29]||(t[29]=l("p",null,"移除手动分配，恢复 Docker 默认的区域管理：",-1)),t[30]||(t[30]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --zone=trusted"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --remove-interface=docker0"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --permanent")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --reload")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," systemctl"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," restart"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," docker")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[31]||(t[31]=l("blockquote",null,[l("p",null,[s("用途：让 Docker 能自动将网桥接口归属到 "),l("code",null,"docker"),s(" zone。")])],-1)),t[32]||(t[32]=l("p",null,"再次查看区域：",-1)),t[33]||(t[33]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --get-active-zones")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[34]||(t[34]=l("blockquote",null,[l("p",null,[s("可见："),l("code",null,"docker0"),s("、"),l("code",null,"br-xxxxxx"),s(" 等接口已自动归属 docker zone。")])],-1)),t[35]||(t[35]=l("hr",null,null,-1)),t[36]||(t[36]=l("h2",{id:"_6-问题解决-让-docker-自主管理区域",tabindex:"-1"},[s("6. 问题解决：让 Docker 自主管理区域 "),l("a",{class:"header-anchor",href:"#_6-问题解决-让-docker-自主管理区域","aria-label":'Permalink to "6. 问题解决：让 Docker 自主管理区域"'},"​")],-1)),t[37]||(t[37]=l("p",null,[s("让 Docker 自主管理区域后，容器间网络通信随即恢复正常，无需手动干预防火墙规则。此时，所有 Docker 相关网桥接口（如 "),l("code",null,"docker0"),s("、"),l("code",null,"br-xxxxxx"),s("、"),l("code",null,"docker_gwbridge"),s("）均自动归属 "),l("code",null,"docker"),s(" 区域，由 Docker 服务启动时自动分配和管理。")],-1)),t[38]||(t[38]=l("hr",null,null,-1)),t[39]||(t[39]=l("h2",{id:"_7-实战总结与最佳实践",tabindex:"-1"},[s("7. 实战总结与最佳实践 "),l("a",{class:"header-anchor",href:"#_7-实战总结与最佳实践","aria-label":'Permalink to "7. 实战总结与最佳实践"'},"​")],-1)),t[40]||(t[40]=l("p",null,[l("strong",null,"（1）切勿手动分配 Docker 网桥到 firewalld 其他 zone"),s(" Docker 启动会自动管理其网桥接口的区域归属。如果手动分配到 "),l("code",null,"trusted"),s("、"),l("code",null,"FedoraWorkstation"),s(" 等 zone，会导致 ZONE_CONFLICT 报错，Docker 服务无法启动。")],-1)),t[41]||(t[41]=l("p",null,[l("strong",null,"（2）防火墙规则优化建议"),s(" 如需放行容器端口，对外暴露服务端口时，建议在 "),l("code",null,"docker"),s(" zone 进行端口开放。例如：")],-1)),t[42]||(t[42]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --zone=docker"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --add-port=6379/tcp"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --permanent")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --reload")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[43]||(t[43]=l("p",null,[l("strong",null,"（3）多桥网络场景"),s(" 如有自定义网络（如 "),l("code",null,"br-xxxxxx"),s("），同样让 Docker 自动管理，无需人工干预。可用如下命令检查所有归属：")],-1)),t[44]||(t[44]=l("div",{class:"language-sh"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"sh"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sudo"),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firewall-cmd"),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --get-active-zones")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),t[45]||(t[45]=l("p",null,"若发现 Docker 网桥未归属于 docker zone，优先排查 Docker 启动日志和 firewalld 配置。",-1)),t[46]||(t[46]=l("hr",null,null,-1)),t[47]||(t[47]=l("h2",{id:"_8-常见问题速查",tabindex:"-1"},[s("8. 常见问题速查 "),l("a",{class:"header-anchor",href:"#_8-常见问题速查","aria-label":'Permalink to "8. 常见问题速查"'},"​")],-1)),t[48]||(t[48]=l("ul",null,[l("li",null,[l("strong",null,"容器互 ping 失败但主机映射端口可访问？"),s(" 首查防火墙 zone 分配和规则，确认 Docker zone自动归属。")]),l("li",null,[l("strong",null,"Docker 启动报 ZONE_CONFLICT？"),s(" 立即移除手动绑定，恢复自动管理。")]),l("li",null,[l("strong",null,"多网卡/虚拟网卡场景（如 zerotier、libvirt）"),s(" 建议分别分配到合适 zone，避免与 Docker zone 冲突。")])],-1)),t[49]||(t[49]=l("hr",null,null,-1)),t[50]||(t[50]=l("h2",{id:"_9-总结流程图",tabindex:"-1"},[s("9. 总结流程图 "),l("a",{class:"header-anchor",href:"#_9-总结流程图","aria-label":'Permalink to "9. 总结流程图"'},"​")],-1)),S(p,T({code:"Zmxvd2NoYXJ0IFRECiAgICBBW-WuueWZqOS6kuiBlOW8guW4uF0gLS0-IEJb5p-l55yLIERvY2tlciDnvZHnu5zlkozpmLLngavlopnljLrln59dCiAgICBCIC0tPiBDe-e9keahpeaOpeWPo-W9kuWxniB0cnVzdGVkIOetiSB6b25lP30KICAgIEMgLS0g5pivIC0tPiBEW-enu-mZpOaJi-WKqOWIhumFjSwg6K6pIERvY2tlciB6b25lIOiHquWKqOeuoeeQhl0KICAgIEMgLS0g5ZCmIC0tPiBFW-ajgOafpSBEb2NrZXIgem9uZSDphY3nva5dCiAgICBEIC0tPiBGW-mHjeWQryBEb2NrZXIg5pyN5YqhXQogICAgRSAtLT4gRgogICAgRiAtLT4gR1vlrrnlmajkupLogZTmgaLlpI1d"},{}),null,16),t[51]||(t[51]=l("hr",null,null,-1)),t[52]||(t[52]=l("h2",{id:"_10-建议与经验",tabindex:"-1"},[s("10. 建议与经验 "),l("a",{class:"header-anchor",href:"#_10-建议与经验","aria-label":'Permalink to "10. 建议与经验"'},"​")],-1)),t[53]||(t[53]=l("ul",null,[l("li",null,[s("Fedora 42 以后，"),l("strong",null,"nftables + firewalld + Docker zone"),s(" 是容器网络安全的标准方案。")]),l("li",null,"遇到网络问题，首查 zone 归属和 Docker 日志，少走弯路。"),l("li",null,"如有复杂多网桥、虚拟化环境，建议梳理所有接口的归属，分类管理，避免 zone 冲突。")],-1)),t[54]||(t[54]=l("hr",null,null,-1)),t[55]||(t[55]=l("h2",{id:"参考命令速查表",tabindex:"-1"},[s("参考命令速查表 "),l("a",{class:"header-anchor",href:"#参考命令速查表","aria-label":'Permalink to "参考命令速查表"'},"​")],-1)),t[56]||(t[56]=l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"操作"),l("th",null,"命令"),l("th")])]),l("tbody",null,[l("tr",null,[l("td",null,"查看网络接口归属"),l("td",null,[l("code",null,"sudo firewall-cmd --get-active-zones")]),l("td")]),l("tr",null,[l("td",null,"查看 Docker 网络"),l("td",null,[l("code",null,"docker network inspect <网络名>")]),l("td")]),l("tr",null,[l("td",null,"移除接口手动分配"),l("td",null,[l("code",null,"sudo firewall-cmd --zone=<zone> --remove-interface=<iface>")]),l("td")]),l("tr",null,[l("td",null,"重载防火墙"),l("td",null,[l("code",null,"sudo firewall-cmd --reload")]),l("td")]),l("tr",null,[l("td",null,"重启 Docker 服务"),l("td",null,[l("code",null,"sudo systemctl restart docker")]),l("td")]),l("tr",null,[l("td",null,"查看 Docker 启动日志"),l("td",null,[l("code",null,"sudo journalctl -xeu docker.service")]),l("td",null,"tail -n 50`")])])],-1))]),"main-header":u(()=>[h(n.$slots,"main-header")]),"main-header-after":u(()=>[h(n.$slots,"main-header-after")]),"main-nav":u(()=>[h(n.$slots,"main-nav")]),"main-content-before":u(()=>[h(n.$slots,"main-content-before")]),"main-content":u(()=>[h(n.$slots,"main-content")]),"main-content-after":u(()=>[h(n.$slots,"main-content-after")]),"main-nav-before":u(()=>[h(n.$slots,"main-nav-before")]),"main-nav-after":u(()=>[h(n.$slots,"main-nav-after")]),comment:u(()=>[h(n.$slots,"comment")]),footer:u(()=>[h(n.$slots,"footer")]),aside:u(()=>[h(n.$slots,"aside")]),"aside-custom":u(()=>[h(n.$slots,"aside-custom")]),default:u(()=>[h(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{xl as default,kl as usePageData};
