import{_ as o}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CVz-OEk3.js";import"./chunks/@vueuse/motion.Bjv2JULu.js";import{e as g,u as c,a as y}from"./chunks/vue-router.CkK6wkE3.js";import{aa as u,al as n,ad as e,ae as s,ah as m,ai as i,F,ab as b,Z as C}from"./framework.DiIp3j3P.js";import"./app.DYfWnlAw.js";import"./chunks/dayjs.Byk5cVHE.js";import"./chunks/vue-i18n.Cqw7qwJJ.js";import"./chunks/pinia.DAg2g0nX.js";import"./chunks/nprogress.QNtX8Req.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.YMmXRdII.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.NFwy7W3t.js";import"./post.DSQTc9o3.js";const v=g("/posts/CICDk8s",async t=>JSON.parse('{"title":"在k8s中构建CICD","description":"","frontmatter":{"layout":"post","title":"在k8s中构建CICD","date":"2024-02-27 15:07:00","tags":["CentOS","Linux","Kubernetes"],"categories":["云计算","Devops","Jenkins"],"cover":"https://www.kubernetes.org.cn/img/2020/10/jenkins-logo.jpg","password":null,"hide":null},"headers":[],"relativePath":"pages/posts/CICDk8s.md","lastUpdated":1758206429000}'),{lazy:(t,k)=>t.name===k.name}),S={__name:"CICDk8s",setup(t,{expose:k}){const{data:p}=v(),r=y(),d=c(),h=Object.assign(d.meta.frontmatter||{},p.value?.frontmatter||{});return r.currentRoute.value.data=p.value,C("valaxy:frontmatter",h),globalThis.$frontmatter=h,k({frontmatter:{layout:"post",title:"在k8s中构建CICD",date:"2024-02-27 15:07:00",tags:["CentOS","Linux","Kubernetes"],categories:["云计算","Devops","Jenkins"],cover:"https://www.kubernetes.org.cn/img/2020/10/jenkins-logo.jpg",password:null,hide:null}}),(l,a)=>{const E=o;return b(),u(E,{frontmatter:F(h)},{"main-content-md":n(()=>[a[0]||(a[0]=s("blockquote",null,[s("p",null,[i("此文章已经停止更新，最新的CICD 构建位于："),s("a",{href:"https://blog.horonlee.com/posts/KubernetesJenkinCICD",target:"_blank",rel:"noreferrer"},"kubernetes 使用 Jenkins&GitLab 构建 CICD - 皓然小站 (horonlee.com)")])],-1)),a[1]||(a[1]=s("h1",{id:"安装cicd所需资源",tabindex:"-1"},[i("安装CICD所需资源 "),s("a",{class:"header-anchor",href:"#安装cicd所需资源","aria-label":'Permalink to "安装CICD所需资源"'},"​")],-1)),a[2]||(a[2]=s("p",null,[s("code",null,"curl -O http://mirrors.douxuedu.com/competition/BlueOcean.tar.gz && tar -zxf BlueOcean.tar.gz && cp BlueOcean/tools/docker-compose-Linux-x86_64 /usr/bin/docker-compose && docker-compose version && tar -zxf BlueOcean/harbor-offline-installer.tar.gz -C /opt/ && sh /opt/harbor/install.sh && docker login -uadmin -pHarbor12345 172.16.2.90 && docker load -i BlueOcean/images/maven_latest.tar && docker tag maven 172.16.2.90/library/maven && docker push 172.16.2.90/library/maven && docker load -i BlueOcean/images/java_8-jre.tar && docker load -i BlueOcean/images/jenkins_jenkins_latest.tar && docker load -i BlueOcean/images/gitlab_gitlab-ce_latest.tar && kubectl create ns devops")],-1)),m(" more "),a[3]||(a[3]=s("h1",{id:"部署应用",tabindex:"-1"},[i("部署应用 "),s("a",{class:"header-anchor",href:"#部署应用","aria-label":'Permalink to "部署应用"'},"​")],-1)),a[4]||(a[4]=s("h2",{id:"jenkins部署",tabindex:"-1"},[i("Jenkins部署 "),s("a",{class:"header-anchor",href:"#jenkins部署","aria-label":'Permalink to "Jenkins部署"'},"​")],-1)),a[5]||(a[5]=s("p",null,[i("容器部分 "),s("code",null,"kubectl create deployment jenkins --image=jenkins/jenkins:latest --namespace=devops --port=8080 --dry-run=client -o yaml >> jenkins.yaml"),i(" 服务部分 "),s("code",null,"kubectl create service nodeport jenkins --tcp=8080:8080 --namespace=devops --dry-run=client -o yaml >> jenkins.yaml"),i(" 修改部分内容")],-1)),a[6]||(a[6]=s("div",{class:"language-yaml"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      serviceAccountName"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        imagePullPolicy"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"IfNotPresent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        securityContext"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          runAsUser"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          privileged"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        volumeMounts"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkinshome")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/run/docker.sock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"dockersock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/root/.kube")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubeconfig")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      volumes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkinshome")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/home/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"dockersock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/run/docker.sock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubeconfig")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/root/.kube")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    nodePort"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30880")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create clusterrole jenkins --verb=* --resource=* --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create serviceaccount jenkins --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create clusterrolebinding jenkins --clusterrole=jenkins --serviceaccount=devops:jenkins --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[7]||(a[7]=s("h2",{id:"gitlab部署",tabindex:"-1"},[i("GitLab部署 "),s("a",{class:"header-anchor",href:"#gitlab部署","aria-label":'Permalink to "GitLab部署"'},"​")],-1)),a[8]||(a[8]=s("p",null,[i("容器部分 "),s("code",null,"kubectl create deployment gitlab --image=gitlab/gitlab-ce:latest --port=80 --namespace=devops --dry-run=client -o yaml >> gitlab.yaml"),i(" 服务部分 "),s("code",null,"kubectl create service nodeport gitlab --tcp=80:80 --namespace=devops --dry-run=client -o yaml >> gitlab.yaml"),i(" 修改部分内容")],-1)),a[9]||(a[9]=s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"        env:")]),i(`
`),s("span",{class:"line"},[s("span",null,"        - name: GITLAB_ROOT_PASSWORD")]),i(`
`),s("span",{class:"line"},[s("span",null,"          value: admin@123")]),i(`
`),s("span",{class:"line"},[s("span",null,"        - name: GITLAB_PORT")]),i(`
`),s("span",{class:"line"},[s("span",null,'          value: "80"')])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[10]||(a[10]=s("h2",{id:"jenkinsfile流水线",tabindex:"-1"},[i("Jenkinsfile流水线 "),s("a",{class:"header-anchor",href:"#jenkinsfile流水线","aria-label":'Permalink to "Jenkinsfile流水线"'},"​")],-1)),a[11]||(a[11]=s("div",{class:"language-"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"pipeline{")]),i(`
`),s("span",{class:"line"},[s("span",null,"    agent none")]),i(`
`),s("span",{class:"line"},[s("span",null,"    stages{")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('mvn-build'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent {")]),i(`
`),s("span",{class:"line"},[s("span",null,"                docker {")]),i(`
`),s("span",{class:"line"},[s("span",null,"                    image '10.26.15.244/library/maven'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                    args '-v /root/.m2:/root/.m2'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                }")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cp -rfv /opt/repository /root/.m2/ && ls -l /root/.m2/repository'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'mvn package -DskipTests'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true ")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('image-build'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent any")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cd gateway && docker build -t 10.26.15.244/springcloud/gateway -f Dockerfile .'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cd config && docker build -t 10.26.15.244/springcloud/config -f Dockerfile .'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker login 10.26.15.244 -u=admin -p=Harbor12345'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker push 10.26.15.244/springcloud/gateway'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker push 10.26.15.244/springcloud/config'")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('cloud-deploy'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent any")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl create ns springcloud'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/deployment/gateway-deployment.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/deployment/config-deployment.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/svc/gateway-svc.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/svc/config-svc.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"    }")]),i(`
`),s("span",{class:"line"},[s("span",null,"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[12]||(a[12]=s("h1",{id:"使用nfs和pvc持久化存储jenkins数据",tabindex:"-1"},[i("使用NFS和PVC持久化存储Jenkins数据 "),s("a",{class:"header-anchor",href:"#使用nfs和pvc持久化存储jenkins数据","aria-label":'Permalink to "使用NFS和PVC持久化存储Jenkins数据"'},"​")],-1)),a[13]||(a[13]=s("h2",{id:"配置nfs服务",tabindex:"-1"},[i("配置NFS服务 "),s("a",{class:"header-anchor",href:"#配置nfs服务","aria-label":'Permalink to "配置NFS服务"'},"​")],-1)),a[14]||(a[14]=s("p",null,"Worker节点",-1)),a[15]||(a[15]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mkdir"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"vi"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/exports")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"写入：/opr/jenkins_home"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," *"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"rw,sync,no_root_squash"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enable"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs-server"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --now")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[16]||(a[16]=s("p",null,"Master节点",-1)),a[17]||(a[17]=s("div",{class:"language-bash"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mkdir"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mount"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs-server-ip:/opt/jenkins_home"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"df"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Th"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"输出：$nfs-server-ip-address:/opt/jenkins_home"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs4"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 40G"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 19G"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 22G"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 46%"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[18]||(a[18]=s("h2",{id:"nfs-storage实现jenkins持久化存储",tabindex:"-1"},[i("nfs-storage实现Jenkins持久化存储 "),s("a",{class:"header-anchor",href:"#nfs-storage实现jenkins持久化存储","aria-label":'Permalink to "nfs-storage实现Jenkins持久化存储"'},"​")],-1)),a[19]||(a[19]=s("p",null,"在deployment下方加上卷挂载信息",-1)),a[20]||(a[20]=s("div",{class:"language-yaml"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        volumeMounts"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      volumes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        persistentVolumeClaim"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          claimName"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pvc")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[21]||(a[21]=s("p",null,"创建pv.yaml",-1)),a[22]||(a[22]=s("div",{class:"language-yaml"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"apiVersion"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"v1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kind"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PersistentVolume")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metadata"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pv")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spec"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  capacity"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    storage"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5Gi")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  accessModes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ReadWriteOnce")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  nfs"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    server"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$nfs-server-ip-address")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/opt/jenkins_home")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[23]||(a[23]=s("p",null,"创建pvc.yaml",-1)),a[24]||(a[24]=s("div",{class:"language-yaml"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"apiVersion"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"v1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kind"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PersistentVolumeClaim")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metadata"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pvc")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spec"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  accessModes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ReadWriteOnce")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  resources"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    requests"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      storage"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5Gi")])])]),s("button",{class:"code-block-unfold-btn"})],-1))]),"main-header":n(()=>[e(l.$slots,"main-header")]),"main-header-after":n(()=>[e(l.$slots,"main-header-after")]),"main-nav":n(()=>[e(l.$slots,"main-nav")]),"main-content-before":n(()=>[e(l.$slots,"main-content-before")]),"main-content":n(()=>[e(l.$slots,"main-content")]),"main-content-after":n(()=>[e(l.$slots,"main-content-after")]),"main-nav-before":n(()=>[e(l.$slots,"main-nav-before")]),"main-nav-after":n(()=>[e(l.$slots,"main-nav-after")]),comment:n(()=>[e(l.$slots,"comment")]),footer:n(()=>[e(l.$slots,"footer")]),aside:n(()=>[e(l.$slots,"aside")]),"aside-custom":n(()=>[e(l.$slots,"aside-custom")]),default:n(()=>[e(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{S as default,v as usePageData};
