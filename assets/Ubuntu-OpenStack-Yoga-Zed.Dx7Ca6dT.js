import{_ as h}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BKY0BFev.js";import"./chunks/@vueuse/motion.C1YF0VrX.js";import{d as m,u as b,a as k}from"./chunks/vue-router.B0lpXBWQ.js";import{X as f,b3 as g,b_ as e,be as s,_ as a,a5 as l,bB as v,b5 as _}from"./framework.tSB2Odh-.js";import"./app.CfWrNu88.js";import"./chunks/dayjs.BmWuu2Zz.js";import"./chunks/vue-i18n.CP2UHYEb.js";import"./chunks/pinia.BF0-M7Fk.js";import"./chunks/nprogress.YXB5kar1.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.DoC94HOc.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CBF25nPr.js";import"./post.TKccRjPH.js";const S=m("/posts/Ubuntu-OpenStack-Yoga-Zed",async t=>JSON.parse('{"title":"Ubuntu搭建OpenStack-Yoga(Zed)","description":"","frontmatter":{"title":"Ubuntu搭建OpenStack-Yoga(Zed)","businesscard":true,"date":"2023-02-23 22:30:44","tags":["CentOS","Linux","OpenStack"],"categories":["服务器运维","集群","OpenStack-Yoga(Zed)"],"cover":"https://tse1-mm.cn.bing.net/th/id/OIP-C.CZwj5SbW0RXNrztZceTZtwHaEK?pid=ImgDet&rs=1"},"headers":[],"relativePath":"pages/posts/Ubuntu-OpenStack-Yoga-Zed.md","lastUpdated":1767692976000}'),{lazy:(t,o)=>t.name===o.name}),M={__name:"Ubuntu-OpenStack-Yoga-Zed",setup(t,{expose:o}){const{data:i}=S(),p=b(),u=k(),r=Object.assign(u.meta.frontmatter||{},i.value?.frontmatter||{});return p.currentRoute.value.data=i.value,_("valaxy:frontmatter",r),globalThis.$frontmatter=r,o({frontmatter:{title:"Ubuntu搭建OpenStack-Yoga(Zed)",businesscard:!0,date:"2023-02-23 22:30:44",tags:["CentOS","Linux","OpenStack"],categories:["服务器运维","集群","OpenStack-Yoga(Zed)"],cover:"https://tse1-mm.cn.bing.net/th/id/OIP-C.CZwj5SbW0RXNrztZceTZtwHaEK?pid=ImgDet&rs=1"}}),(n,c)=>{const d=h;return g(),f(d,{frontmatter:v(r)},{"main-content-md":e(()=>[...c[0]||(c[0]=[a("h1",{id:"ubuntu搭建openstack-zed",tabindex:"-1"},[l("Ubuntu搭建OpenStack-Zed "),a("a",{class:"header-anchor",href:"#ubuntu搭建openstack-zed","aria-label":'Permalink to "Ubuntu搭建OpenStack-Zed"'},"​")],-1),a("p",null,"注意：本篇只作为个人笔记，记录搭建过程的一些坑和问题，仅供参考！ 所有服务的密码都是123456。",-1),a("h1",{id:"网络配置",tabindex:"-1"},[l("网络配置 "),a("a",{class:"header-anchor",href:"#网络配置","aria-label":'Permalink to "网络配置"'},"​")],-1),a("ol",null,[a("li",null,"Nat网卡用于下载文件：192.168.74.128~131"),a("li",null,"仅主机：192.168.100.*"),a("li",null,"仅主机：192.168.200.* 子网掩码：255.255.255.0(/24) 以下是网卡静态配置，ens34和ens35就是两张仅主机网卡（配置为静态），ens33是NAT网卡（无所谓）。")],-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"# This is the network config written by 'subiquity'")]),l(`
`),a("span",{class:"line"},[a("span",null,"network:")]),l(`
`),a("span",{class:"line"},[a("span",null,"  ethernets:")]),l(`
`),a("span",{class:"line"},[a("span",null,"    ens33:")]),l(`
`),a("span",{class:"line"},[a("span",null,"      dhcp4: true")]),l(`
`),a("span",{class:"line"},[a("span",null,"    ens34:")]),l(`
`),a("span",{class:"line"},[a("span",null,"      addresses: [192.168.100.129/24]")]),l(`
`),a("span",{class:"line"},[a("span",null,"      dhcp4: false")]),l(`
`),a("span",{class:"line"},[a("span",null,"      nameservers:")]),l(`
`),a("span",{class:"line"},[a("span",null,"        addresses: [114.114.114.114]")]),l(`
`),a("span",{class:"line"},[a("span",null,"    ens35:")]),l(`
`),a("span",{class:"line"},[a("span",null,"      addresses: [192.168.200.129/24]")]),l(`
`),a("span",{class:"line"},[a("span",null,"      dhcp4: false")]),l(`
`),a("span",{class:"line"},[a("span",null,"      nameservers:")]),l(`
`),a("span",{class:"line"},[a("span",null,"        addresses: [114.114.114.114]")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"hosts",tabindex:"-1"},[l("hosts "),a("a",{class:"header-anchor",href:"#hosts","aria-label":'Permalink to "hosts"'},"​")],-1),a("p",null,"127.0.0.1 localhost 192.168.100.128 controller 192.168.100.129 computer 192.168.100.130 computer1 192.168.100.131 block 配置完之后每个节点互相用host名ping一下看看能不能互相ping通",-1),a("blockquote",null,[a("p",null,"官网的配置 10.0.0.11 controller 10.0.0.31 compute1 10.0.0.41 block1")],-1),a("h1",{id:"controller",tabindex:"-1"},[l("controller "),a("a",{class:"header-anchor",href:"#controller","aria-label":'Permalink to "controller"'},"​")],-1),a("h2",{id:"网卡",tabindex:"-1"},[l("网卡 "),a("a",{class:"header-anchor",href:"#网卡","aria-label":'Permalink to "网卡"'},"​")],-1),a("ol",null,[a("li",null,"nes33：192.168.74.128"),a("li",null,"ens34：192.168.100.128"),a("li",null,"ens35：192.168.200.128")],-1),a("h2",{id:"ntp服务",tabindex:"-1"},[l("NTP服务 "),a("a",{class:"header-anchor",href:"#ntp服务","aria-label":'Permalink to "NTP服务"'},"​")],-1),a("blockquote",null,[a("p",null,"重点：local stratum 10 # 开启，即使server指令中时间服务器不可用，也允许将本地时间作为标准时间授予其他客户端")],-1),a("p",null,[l("在chronyd.conf文件中务必加上"),a("code",null,"local stratum 10"),l("，参数，否则会造成有NTP服务的连接但是同步数据，即为0ns延迟！(其实写个1也可以的)")],-1),a("h2",{id:"安装",tabindex:"-1"},[l("安装 "),a("a",{class:"header-anchor",href:"#安装","aria-label":'Permalink to "安装"'},"​")],-1),a("p",null,"add-apt-repository cloud-archive:zed apt install python3-openstackclient",-1),a("h2",{id:"sql数据库",tabindex:"-1"},[l("SQL数据库 "),a("a",{class:"header-anchor",href:"#sql数据库","aria-label":'Permalink to "SQL数据库"'},"​")],-1),a("p",null,[l("apt install mariadb-server python3-pymysql 执行"),a("code",null,"mysql_secure_installation"),l("的过程中我没有禁止root账户远程登录数据库。")],-1),a("h2",{id:"消息队列",tabindex:"-1"},[l("消息队列 "),a("a",{class:"header-anchor",href:"#消息队列","aria-label":'Permalink to "消息队列"'},"​")],-1),a("p",null,"apt install rabbitmq-server 记得密码123456和给权限",-1),a("h2",{id:"memcached",tabindex:"-1"},[l("Memcached "),a("a",{class:"header-anchor",href:"#memcached","aria-label":'Permalink to "Memcached"'},"​")],-1),a("p",null,"apt install memcached python3-memcache -l 192.168.100.128",-1),a("h2",{id:"etcd",tabindex:"-1"},[l("Etcd "),a("a",{class:"header-anchor",href:"#etcd","aria-label":'Permalink to "Etcd"'},"​")],-1),a("p",null,"apt install etcd",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,'ETCD_NAME="controller"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_DATA_DIR="/var/lib/etcd"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_INITIAL_CLUSTER_STATE="new"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster-01"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_INITIAL_CLUSTER="controller=http://192.168.100.128:2380"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_INITIAL_ADVERTISE_PEER_URLS="http://192.168.100.128:2380"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_ADVERTISE_CLIENT_URLS="http://192.168.100.128:2379"')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_LISTEN_PEER_URLS="http://0.0.0.0:2380"     #存疑')]),l(`
`),a("span",{class:"line"},[a("span",null,'ETCD_LISTEN_CLIENT_URLS="http://192.168.100.128:2379"')])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"出大问题",tabindex:"-1"},[l("出大问题 "),a("a",{class:"header-anchor",href:"#出大问题","aria-label":'Permalink to "出大问题"'},"​")],-1),a("p",null,[l("OpenStack官网没有Zed的OpenStack主体安装指南？我还没法用"),a("code",null,"add-apt-repository cloud-archive:yoga"),l("来换软件源，啊！ 还好后来找到了（")],-1),a("h2",{id:"keystone",tabindex:"-1"},[l("Keystone "),a("a",{class:"header-anchor",href:"#keystone","aria-label":'Permalink to "Keystone"'},"​")],-1),a("p",null,"数据库巴拉巴拉 Apache Http服务加一个ServerName controller 老规矩新建admin-openrc作为keystone的管理员认证变量",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"export OS_USERNAME=admin")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_PASSWORD=123456")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_PROJECT_NAME=admin")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_USER_DOMAIN_NAME=Default")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_PROJECT_DOMAIN_NAME=Default")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_AUTH_URL=http://controller:5000/v3")]),l(`
`),a("span",{class:"line"},[a("span",null,"export OS_IDENTITY_API_VERSION=3")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"glance",tabindex:"-1"},[l("Glance "),a("a",{class:"header-anchor",href:"#glance","aria-label":'Permalink to "Glance"'},"​")],-1),a("p",null,"数据库巴拉巴拉 注册限额设置就不设置了（怕麻烦bushi）",-1),a("p",null,"不确定：在/etc/glance/glance-api.conf中，配置对梯形失真的访问权限：[oslo_limit]",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"[oslo_limit]")]),l(`
`),a("span",{class:"line"},[a("span",null,"auth_url = http://controller:5000")]),l(`
`),a("span",{class:"line"},[a("span",null,"auth_type = password")]),l(`
`),a("span",{class:"line"},[a("span",null,"user_domain_id = default")]),l(`
`),a("span",{class:"line"},[a("span",null,"username = MY_SERVICE #不知道需不需要改为123456，文档没说要改")]),l(`
`),a("span",{class:"line"},[a("span",null,"system_scope = all")]),l(`
`),a("span",{class:"line"},[a("span",null,"password = MY_PASSWORD  #不知道需不需要改为123456，文档没说要改")]),l(`
`),a("span",{class:"line"},[a("span",null,"endpoint_id = ENDPOINT_ID")]),l(`
`),a("span",{class:"line"},[a("span",null,"region_name = RegionOne")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"不确定：确保MY_SERVICE帐户具有读者访问权限 系统范围资源（如限制）：",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"root@controller:/home/controller# openstack role add --user MY_SERVICE --user-domain Default --system all reader")]),l(`
`),a("span",{class:"line"},[a("span",null,"No user with a name or ID of 'MY_SERVICE' exists.")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"吐槽一句，文档给的测试镜像cirros下载实在是太慢了，我用香港的服务器下载才好一点，国内科学上网还是慢。",-1),a("h2",{id:"placement",tabindex:"-1"},[l("Placement "),a("a",{class:"header-anchor",href:"#placement","aria-label":'Permalink to "Placement"'},"​")],-1),a("p",null,"数据库巴拉巴拉",-1),a("h2",{id:"nova",tabindex:"-1"},[l("Nova "),a("a",{class:"header-anchor",href:"#nova","aria-label":'Permalink to "Nova"'},"​")],-1),a("p",null,"数据库巴拉巴拉",-1),a("h2",{id:"将计算节点添加到单元数据库",tabindex:"-1"},[l("将计算节点添加到单元数据库 "),a("a",{class:"header-anchor",href:"#将计算节点添加到单元数据库","aria-label":'Permalink to "将计算节点添加到单元数据库"'},"​")],-1),a("p",null,[a("strong",null,"注意，本操作需要在所有computer节点配置好nova服务之后执行！")],-1),a("ul",null,[a("li",null,[l("列出来nove节点："),a("code",null,"openstack compute service list --service nova-compute"),a("ul",null,[a("li",null,"我这里就会出现三个节点，其中两个是computer和computer1，当然controller也会有一个/")])]),a("li",null,[l("列出当前所有服务节点："),a("code",null,"openstack compute service list")]),a("li",null,[l("列出当前所有服务的API端点"),a("code",null,"openstack catalog list")]),a("li",null,[l("列出当前所有镜像"),a("code",null,"openstack image list")])],-1),a("p",null,"添加新计算节点时，必须在控制器节点上运行以注册这些新计算 节点。或者，您可以在 中设置适当的间隔：nova-manage cell_v2 discover_hosts/etc/nova/nova.conf",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"[scheduler]")]),l(`
`),a("span",{class:"line"},[a("span",null,"discover_hosts_in_cells_interval = 300")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("h2",{id:"neutron",tabindex:"-1"},[l("Neutron "),a("a",{class:"header-anchor",href:"#neutron","aria-label":'Permalink to "Neutron"'},"​")],-1),a("p",null,[l("先配置controller再配置其他节点 "),a("strong",null,"注意"),l("：一般使用"),a("code",null,"网络选项 2：自助服务网络"),l("来配置网络")],-1),a("p",null,[l("出大问题，执行"),a("code",null,"openstack extension list --network"),l("指令验证网络操作结果输出"),a("code",null,"Faild to retreieve extensions list from Network API"),l("，这不纯纯的寄了吗？这都最后一个服务了啊，就差一个面板了，啊啊啊啊啊啊！！！！")],-1),a("h1",{id:"computer",tabindex:"-1"},[l("computer "),a("a",{class:"header-anchor",href:"#computer","aria-label":'Permalink to "computer"'},"​")],-1),a("h2",{id:"网卡-1",tabindex:"-1"},[l("网卡 "),a("a",{class:"header-anchor",href:"#网卡-1","aria-label":'Permalink to "网卡"'},"​")],-1),a("ol",null,[a("li",null,"nes33：192.168.74.129"),a("li",null,"ens34：192.168.100.129"),a("li",null,"ens35：192.168.200.129")],-1),a("h2",{id:"安装-1",tabindex:"-1"},[l("安装 "),a("a",{class:"header-anchor",href:"#安装-1","aria-label":'Permalink to "安装"'},"​")],-1),a("p",null,"add-apt-repository cloud-archive:zed apt install nova-compute apt install mariadb-server python3-pymysql",-1),a("h2",{id:"nova-1",tabindex:"-1"},[l("nova "),a("a",{class:"header-anchor",href:"#nova-1","aria-label":'Permalink to "nova"'},"​")],-1),a("p",null,"数据库巴拉巴拉",-1),a("blockquote",null,[a("p",null,"[vnc] 如果用于访问远程控制台的 Web 浏览器驻留在 无法解析主机名，必须替换为 控制器节点。controller")],-1),a("p",null,"确定计算节点是否支持硬件加速 虚拟机：",-1),a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"egrep -c '(vmx|svm)' /proc/cpuinfo")])])]),a("button",{class:"code-block-unfold-btn"})],-1),a("p",null,"结果我输出了12？1是支持，0是不支持，那我12是支持还是不支持？暂且假设大于1就是支持吧，那就不用配置为QEMU了。",-1),a("h1",{id:"computer1",tabindex:"-1"},[l("computer1 "),a("a",{class:"header-anchor",href:"#computer1","aria-label":'Permalink to "computer1"'},"​")],-1),a("h2",{id:"网卡-2",tabindex:"-1"},[l("网卡 "),a("a",{class:"header-anchor",href:"#网卡-2","aria-label":'Permalink to "网卡"'},"​")],-1),a("ol",null,[a("li",null,"nes33：192.168.74.130"),a("li",null,"ens34：192.168.100.130"),a("li",null,"ens35：192.168.200.130")],-1),a("h2",{id:"安装-2",tabindex:"-1"},[l("安装 "),a("a",{class:"header-anchor",href:"#安装-2","aria-label":'Permalink to "安装"'},"​")],-1),a("p",null,"add-apt-repository cloud-archive:zed apt install nova-compute",-1),a("h1",{id:"block",tabindex:"-1"},[l("block "),a("a",{class:"header-anchor",href:"#block","aria-label":'Permalink to "block"'},"​")],-1),a("h2",{id:"网卡-3",tabindex:"-1"},[l("网卡 "),a("a",{class:"header-anchor",href:"#网卡-3","aria-label":'Permalink to "网卡"'},"​")],-1),a("ol",null,[a("li",null,"nes33：192.168.74.131"),a("li",null,"ens34：192.168.100.131"),a("li",null,"ens35：92.168.200.131")],-1),a("h2",{id:"安装-3",tabindex:"-1"},[l("安装 "),a("a",{class:"header-anchor",href:"#安装-3","aria-label":'Permalink to "安装"'},"​")],-1),a("p",null,"add-apt-repository cloud-archive:zed apt install python3-openstackclient",-1)])]),"main-header":e(()=>[s(n.$slots,"main-header")]),"main-header-after":e(()=>[s(n.$slots,"main-header-after")]),"main-nav":e(()=>[s(n.$slots,"main-nav")]),"main-content-before":e(()=>[s(n.$slots,"main-content-before")]),"main-content":e(()=>[s(n.$slots,"main-content")]),"main-content-after":e(()=>[s(n.$slots,"main-content-after")]),"main-nav-before":e(()=>[s(n.$slots,"main-nav-before")]),"main-nav-after":e(()=>[s(n.$slots,"main-nav-after")]),comment:e(()=>[s(n.$slots,"comment")]),footer:e(()=>[s(n.$slots,"footer")]),aside:e(()=>[s(n.$slots,"aside")]),"aside-custom":e(()=>[s(n.$slots,"aside-custom")]),default:e(()=>[s(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{M as default,S as usePageData};
